"use strict";(self.webpackChunkdemo1=self.webpackChunkdemo1||[]).push([[1902],{41902:(ee,x,f)=>{f.r(x),f.d(x,{NotificationMatrixModule:()=>X});var n=f(86656),y=f(96814),b=f(15861),g=f(56223),I=f(13519),Z=f.n(I),e=f(65879),E=f(31552),M=f(5588),C=f(64190),w=f(22939),U=f(88672),P=f(16519),S=f(60540);const L=["closeModal"],A=["closeAlert"];function F(d,h){1&d&&(e.TgZ(0,"h2",32),e._uU(1,"Add Notification Matrix Configuration"),e.qZA())}function K(d,h){1&d&&(e.TgZ(0,"h2",32),e._uU(1,"Edit Notification Matrix Configuration"),e.qZA())}function k(d,h){1&d&&(e.TgZ(0,"div",33),e._uU(1," Notification Matrix ID is required "),e.qZA())}function q(d,h){1&d&&(e.TgZ(0,"div",33),e._uU(1," Total Escalation Levels is required and should be between 1 and 10. "),e.qZA())}function O(d,h){if(1&d&&(e.TgZ(0,"div",36)(1,"tr")(2,"label",42),e._uU(3),e.qZA()(),e.TgZ(4,"tr")(5,"td",43)(6,"div",44),e._UZ(7,"input",45),e._uU(8,"Enable SMS"),e.qZA()(),e.TgZ(9,"td",43)(10,"div",44),e._UZ(11,"input",46),e._uU(12," Enable Email"),e.qZA()(),e.TgZ(13,"td",43)(14,"div",44),e._UZ(15,"input",47),e._uU(16,"Enable Telegram"),e.qZA()(),e.TgZ(17,"td",43)(18,"div",44),e._UZ(19,"input",48),e._uU(20,"Enable Type 1"),e.qZA()(),e.TgZ(21,"td",43)(22,"div",44),e._UZ(23,"input",49),e._uU(24,"Enable Type 2"),e.qZA()(),e.TgZ(25,"td",43)(26,"div",44),e._UZ(27,"input",50),e._uU(28,"Enable Type 3"),e.qZA()(),e.TgZ(29,"td",43)(30,"div",44),e._UZ(31,"input",51),e._uU(32,"Enable Type 4"),e.qZA()(),e.TgZ(33,"td",43)(34,"div",44),e._UZ(35,"input",52),e._uU(36,"Enable Type 5"),e.qZA()()()()),2&d){const u=h.$implicit;e.Q6J("formGroupName",h.index),e.xp6(3),e.Oqu(u.value.userID)}}function J(d,h){if(1&d){const u=e.EpF();e.TgZ(0,"div",36),e._UZ(1,"br"),e.TgZ(2,"h3"),e._uU(3),e.qZA(),e.TgZ(4,"label",11),e._uU(5," Users"),e.qZA(),e.TgZ(6,"div",37)(7,"ng-multiselect-dropdown",38),e.NdJ("onSelect",function(t){const l=e.CHM(u).index,a=e.oxw(2);return e.KtG(a.onModuleSelect(l,t))})("onDeSelect",function(t){const l=e.CHM(u).index,a=e.oxw(2);return e.KtG(a.onDeSelect(l,t))})("onSelectAll",function(t){const l=e.CHM(u).index,a=e.oxw(2);return e.KtG(a.onSelectAll(l,t))})("onDeSelectAll",function(){const o=e.CHM(u).index,l=e.oxw(2);return e.KtG(l.onDeSelectAll(o))}),e.qZA(),e._UZ(8,"br")(9,"br"),e.TgZ(10,"label",11),e._uU(11,"Escalation Time"),e.qZA(),e._UZ(12,"input",39),e.TgZ(13,"label",11),e._uU(14,"Escalation Level Comment"),e.qZA(),e._UZ(15,"input",40)(16,"br")(17,"br"),e.TgZ(18,"div",41),e.YNc(19,O,37,2,"div",35),e.qZA(),e._UZ(20,"br")(21,"br"),e.qZA()()}if(2&d){const u=h.index,i=e.oxw(2);e.Q6J("formGroupName",u),e.xp6(3),e.hij("Level ",u+1,""),e.xp6(4),e.Q6J("placeholder","Select Users")("settings",i.dropdownSettings)("data",i.clientNames),e.xp6(12),e.Q6J("ngForOf",i.getPermissions(u).controls)}}function B(d,h){if(1&d&&(e.TgZ(0,"div",34),e.YNc(1,J,22,6,"div",35),e.qZA()),2&d){const u=e.oxw();e.xp6(1),e.Q6J("ngForOf",u.levels.controls)}}function R(d,h){1&d&&(e.TgZ(0,"div",33),e._uU(1," user is required "),e.qZA())}function G(d,h){if(1&d){const u=e.EpF();e.TgZ(0,"button",53),e.NdJ("click",function(){e.CHM(u);const t=e.oxw();return e.KtG(t.updateConfiguration(t.createNewField.value,"id"))}),e._uU(1," Update "),e.qZA()}if(2&d){const u=e.oxw();e.Q6J("hidden",u.hideUpdateButton)("disabled",u.createNewField.invalid||"id already exists"==u.errorForUniqueID||"id already exists"==u.errorForUniqueLabel)("disabled",u.isButtonDisabled())}}function Y(d,h){if(1&d){const u=e.EpF();e.TgZ(0,"button",54),e.NdJ("click",function(){e.CHM(u);const t=e.oxw();return e.KtG(t.createNewNM(""))}),e._uU(1,"Submit"),e.qZA()}if(2&d){const u=e.oxw();e.Q6J("disabled",u.createNewField.invalid||"id already exists"==u.errorForUniqueID||"Device Label already exists"==u.errorForUniqueLabel)}}let H=(()=>{var d;class h{constructor(i,t,o,l,a,r,s,c,m){(0,n.Z)(this,"api",void 0),(0,n.Z)(this,"getDiagnostics",void 0),(0,n.Z)(this,"fb",void 0),(0,n.Z)(this,"router",void 0),(0,n.Z)(this,"toast",void 0),(0,n.Z)(this,"sharedService",void 0),(0,n.Z)(this,"spinner",void 0),(0,n.Z)(this,"cd",void 0),(0,n.Z)(this,"auditTrialServices",void 0),(0,n.Z)(this,"closeModal",void 0),(0,n.Z)(this,"closeAlert",void 0),(0,n.Z)(this,"allModuleValues",[]),(0,n.Z)(this,"createNewField",void 0),(0,n.Z)(this,"permissions",void 0),(0,n.Z)(this,"allDatas",{}),(0,n.Z)(this,"SK_clientID",void 0),(0,n.Z)(this,"getLoggedUser",void 0),(0,n.Z)(this,"submitted",void 0),(0,n.Z)(this,"temp_createNewField",{}),(0,n.Z)(this,"columnDatatable",[]),(0,n.Z)(this,"uniqueDevicesList",[]),(0,n.Z)(this,"uniqueDeviceLabel_list",[]),(0,n.Z)(this,"allPermissions_user",void 0),(0,n.Z)(this,"data_temp",[]),(0,n.Z)(this,"clientNames",void 0),(0,n.Z)(this,"showModal",!1),(0,n.Z)(this,"showHeading",!1),(0,n.Z)(this,"hideUpdateButton",!1),(0,n.Z)(this,"hideDeleteButton",!1),(0,n.Z)(this,"dropdownSettings",{}),(0,n.Z)(this,"multiselectModule",[]),(0,n.Z)(this,"stopTimer",""),(0,n.Z)(this,"maxlength",500),(0,n.Z)(this,"getDialogData",{id:"",client_id:""}),(0,n.Z)(this,"duplicate",void 0),(0,n.Z)(this,"errorForUniqueLabel",void 0),(0,n.Z)(this,"errorForUniqueID",void 0),(0,n.Z)(this,"data",void 0),(0,n.Z)(this,"Lookupdata",void 0),(0,n.Z)(this,"listofNMIds",[]),(0,n.Z)(this,"nm_table",void 0),(0,n.Z)(this,"pbTableData",[]),(0,n.Z)(this,"allPB_details",void 0),(0,n.Z)(this,"edit_delete",!1),(0,n.Z)(this,"common_PK",""),(0,n.Z)(this,"common_SK",""),(0,n.Z)(this,"common_label",""),(0,n.Z)(this,"common_createdTime",""),(0,n.Z)(this,"common_escalationTime",""),(0,n.Z)(this,"common_levels",""),(0,n.Z)(this,"common_others",""),(0,n.Z)(this,"selectedValues",[]),(0,n.Z)(this,"totEscLvl",0),this.api=i,this.getDiagnostics=t,this.fb=o,this.router=l,this.toast=a,this.sharedService=r,this.spinner=s,this.cd=c,this.auditTrialServices=m,this.initializeDeviceFields()}ngOnInit(){var i=this;return(0,b.Z)(function*(){i.Lookupdata=[],i.getLoggedUser=i.getDiagnostics.getLoggedUserDetails(),i.SK_clientID=i.getLoggedUser.attributes["custom:clientID"],i.allPermissions_user=JSON.parse(JSON.parse(JSON.stringify(localStorage.getItem("permissionDetails")))),console.log("this.allPermissions_user",i.allPermissions_user),i.addFromService(),i.loadClientNames(),i.dropdownSettings=i.getDiagnostics.getSettings_NotificationMatrix(),yield i.fetchNMData(1),i.auditTrialServices.audit_trail("2.1","Notification Matrix","Page Load","Notification Matrix Page Loaded",i.listofNMIds.length)})()}initializeDeviceFields(){this.createNewField=this.fb.group({PK:["",g.kI.required],SK:[""],label:["",g.kI.required],totalEscalationLevels:["",[g.kI.required,g.kI.min(1),g.kI.max(10)]],createdTime:[""],updatedTime:[""],levels:this.fb.array([])}),console.log("INITS:",this.createNewField)}onTotalEscalationLevelsChange(i){const t=this.createNewField.get("totalEscalationLevels").value;console.log("TOTAL LEVELS:",t);const o=t;if(console.log(o),o<1||o>10)console.log("PREVENT"),i.preventDefault(),this.totEscLvl=1;else if(this.totEscLvl=0,console.log("CONTINUE"),null!=t){const l=this.levels.length;if(this.cd.detectChanges(),t>l)for(let a=l;a<t;a++)this.levels.push(this.initLevelForm()),this.cd.detectChanges();else for(let a=l;a>t;a--)this.levels.removeAt(a-1),this.cd.detectChanges();this.cd.detectChanges()}}disableScroll(i){i.preventDefault()}onUserSelectChange(i,t){const a=Array.from(t.target.options).filter(s=>s.selected).map(s=>s.value);console.log("USER IDS:",a),this.levels.at(i).get("userIDs")?.setValue(a),this.updateUserPermissions(i,a)}initLevelForm(){return this.fb.group({userIDs:[[]],escalationTime:[""],comments:[""],permissions:this.fb.array([])})}get levels(){return this.createNewField.get("levels")}getPermissions(i){return this.levels.at(i).controls.permissions}updateUserPermissions(i,t){var o=this;return(0,b.Z)(function*(){const a=o.levels.at(i).get("permissions");console.log("P ARRAY1:",a),console.log(a.value);const r=a.value.filter(s=>t.includes(s.userID));console.log(r),a.clear(),console.log("P ARRAY2:",a),t.forEach(s=>{r.some(c=>c.userID===s)||r.push({userID:s,enableSMS:!1,enableEmail:!1,enableTelegram:!1,enableType1:!1,enableType2:!1,enableType3:!1,enableType4:!1,enableType5:!1})}),console.log("FILTERED LIST:",r);for(let s=0;s<r.length;s++){const c=o.fb.group(r[s]);a.push(c)}console.log("PARRAY3:",a),console.log("CREATE NEW FIELD:",o.createNewField)})()}createNewNM(i){var t=this,o=this.createNewField.controls.levels,l=[],a=[],r=[];for(let _=0;_<o.controls.length;_++){var s=o.controls[_];console.log(s),l.push(s.value.escalationTime),a.push(s.value.comments);var c=s.value.userIDs,m=s.controls.permissions;console.log(m),console.log(l),console.log(a);var v=[];for(let p=0;p<m.controls.length;p++)v.push(m.controls[p].value);r.push({users:c,permissions:v,escalationTime:s.value.escalationTime,comments:s.value.comments})}this.allDatas={PK:this.createNewField.value.PK.trim(),SK:this.SK_clientID,label:this.createNewField.value.label,createdTime:`${Math.ceil((new Date).getTime()/1e3)}`,updatedTime:`${Math.ceil((new Date).getTime()/1e3)}`,totalEscalationLevels:this.createNewField.value.totalEscalationLevels,levels:JSON.stringify(r),escalationTime:l,comments:JSON.stringify(a),others:null},console.log("alldata",this.allDatas),this.submitted=!0,console.log("config creation",this.allDatas),this.closeModal.nativeElement.click(),this.api.CreateNotificationMatrix(this.allDatas).then(function(){var _=(0,b.Z)(function*(p){if(console.log("Sending Data"),p){var T={P1:t.allDatas.PK,P2:t.allDatas.label,P3:Math.ceil((new Date).getTime()/1e3)};Math.ceil((new Date).getTime()/1e3),yield t.createLookUpNM(T,1),t.auditTrialServices.audit_trail("2.1","Notification Matrix","Create",`New "${t.allDatas.PK}" NM Created`,"1"),t.toast.open("New Notification Matrix Configuration created successfully"," ",{duration:2e3,horizontalPosition:"right",verticalPosition:"top"})}else alert("Error in Creating Dashboard Configuration")});return function(p){return _.apply(this,arguments)}}()).catch(_=>{console.log("err for creation",_),this.toast.open("Error in Creating New Notification Matrix Configuration ","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"})})}addFromService(){var i=this;return(0,b.Z)(function*(){i.columnDatatable=[],i.columnDatatable=[{data:"PK"},{data:"label"},{data:"createdTime"}],yield i.checkPermission()})()}checkPermission(){var i=this;return(0,b.Z)(function*(){let t=!1,o=!1;console.log("these are permkjk",i.allPermissions_user);for(let l=0;l<i.allPermissions_user.length;l++)"Notification Matrix - Update"===i.allPermissions_user[l]?t=!0:"Notification Matrix - View"===i.allPermissions_user[l]&&(o=!0);t=!0,t||t?i.hideDeleteButton=!0:o?i.hideDeleteButton=!1:i.router.navigate(["/404"])})()}openModal(i){var t=this;return(0,b.Z)(function*(){if(t.totEscLvl=0,t.multiselectModule=[],t.createNewField.reset(),console.log("CreateNewField:",t.createNewField),""==i)console.log("GET VALUES:",i),t.createNewField.get("PK")?.enable(),t.showModal=!1,t.showHeading=!0,t.errorForUniqueLabel="",t.errorForUniqueID="",t.initializeDeviceFields();else if(i){t.showModal=!0,t.showHeading=!1,console.log("values",i);var o=i.PK;console.log("PK:",o),t.initializeDeviceFields(),console.log("CLEARED:",t.createNewField),yield t.api.GetNotificationMatrix(o,t.SK_clientID).then(l=>{if(t.auditTrialServices.audit_trail("2.1","Notification Matrix","View",`"${o}" NM config was viewed`,"1"),l&&void 0!==l){t.data_temp=l,console.log("after sending request,fetched from dynamoDB",t.data_temp),console.log("RIGHT BEFORE ONCLICK");const a=JSON.parse(t.data_temp.levels);t.initializeForm(a,t.data_temp),t.duplicate=JSON.parse(JSON.stringify(t.createNewField.value)),delete t.duplicate.PK,console.log("edit field:",t.createNewField),t.createNewField.get("PK")?.disable(),t.changeDetection()}}).catch(l=>{console.log("cant fetch",l)})}})()}checkUniqueID(i){this.errorForUniqueLabel="";for(let t=0;t<this.listofNMIds.length;t++){if(i==this.listofNMIds[t]){this.errorForUniqueID="id already exists",this.errorForUniqueLabel="ID already exists";break}this.errorForUniqueID=""}}isButtonDisabled(){console.log(this.duplicate,this.createNewField.value);var i=JSON.stringify(this.duplicate)==JSON.stringify(this.createNewField.value);return i||this.createNewField.invalid}updateConfiguration(i,t){var o=this,l=this.createNewField.controls.levels,a=[],r=[],s=[];for(let p=0;p<l.controls.length;p++){var c=l.controls[p];console.log(c),a.push(c.value.escalationTime),r.push(c.value.comments);var m=c.value.userIDs,v=c.controls.permissions;console.log(v),console.log(a),console.log(r);var N=[];for(let T=0;T<v.controls.length;T++)N.push(v.controls[T].value);s.push({users:m,permissions:N,escalationTime:c.value.escalationTime,comments:c.value.comments})}console.log(this.createNewField),this.allDatas={PK:this.createNewField.controls.PK.value,SK:this.SK_clientID,label:this.createNewField.value.label,updatedTime:`${Math.ceil((new Date).getTime()/1e3)}`,totalEscalationLevels:this.createNewField.value.totalEscalationLevels,levels:JSON.stringify(s),escalationTime:a,comments:JSON.stringify(r),others:null},console.log("alldata",this.allDatas),this.closeModal.nativeElement.click(),this.api.UpdateNotificationMatrix(this.allDatas).then(function(){var p=(0,b.Z)(function*(T){if(o.auditTrialServices.audit_trail("2.1","Notification Matrix","Update",`"${o.allDatas.PK}" NM config updated`,"1"),T){console.log("VALUE:",T),o.cd.detectChanges(),o.toast.open("Notification Matrix configuration updated successfully"," ",{duration:2e3,horizontalPosition:"right",verticalPosition:"top"}),o.addFromService();var D={P1:o.allDatas.PK,P2:o.allDatas.label,P3:Math.ceil((new Date).getTime()/1e3)};yield o.fetchNMById(1,o.allDatas.PK,"update",D),o.cd.detectChanges(),yield o.loading()}else alert("Error in Updating Configuration")});return function(T){return p.apply(this,arguments)}}()).catch(p=>{console.log(p),this.toast.open("Error in Updating Configuration ","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"})})}loadClientNames(){var i=this;return(0,b.Z)(function*(){try{i.clientNames=yield i.sharedService.getUserConfiguration(i.SK_clientID),console.log("cjkkk",i.clientNames)}catch(t){console.log("Error loading client names",t)}})()}onModuleSelect(i,t){console.log("selected option client sees",t);const o=(this.levels.at(i).get("userIDs")?.value).map(l=>l.PK)||[];o.includes(t.PK)||(o.push(t.PK),this.levels.at(i).get("userIDs")?.setValue(o)),console.log("userIDs",o),this.updateUserPermissions(i,o)}onDeSelect(i,t){const o=(this.levels.at(i).get("userIDs")?.value).map(a=>a.PK)||[];console.log(o);const l=o.indexOf(t.PK);-1!==l&&(o.splice(l,1),this.levels.at(i).get("userIDs")?.setValue(o)),console.log("userIDs",o),this.updateUserPermissions(i,o)}onSelectAll(i,t){const o=t.map(l=>l.PK);this.levels.at(i).get("userIDs")?.setValue(o),console.log("userIDs",o),this.updateUserPermissions(i,o)}onDeSelectAll(i){this.levels.at(i).get("userIDs")?.setValue([]),this.updateUserPermissions(i,[])}fetchNMData(i){var t=this;return(0,b.Z)(function*(){try{const o=yield t.api.GetLookupMasterTable(t.SK_clientID+"#notification_matrix",i);if(o&&o.items)if("string"==typeof o.items){let l=JSON.parse(o.items);if(Array.isArray(l)){for(let a=0;a<l.length;a++){const r=l[a];if(null==r)break;{const s=Object.keys(r)[0],{P1:c,P2:m,P3:v}=r[s];t.Lookupdata.push([c,m,v])}}yield t.fetchNMData(i+1)}else console.error("Invalid data format - not an array.")}else console.error("response.listOfItems is not a string.");else t.Lookupdata.sort((l,a)=>a[2]-l[2]),t.listofNMIds=[],t.listofNMIds=t.Lookupdata.map(l=>l[0]),t.showDatatable(t.Lookupdata),t.auditTrialServices.audit_trail("2.1","Notification Matrix","View","NM Table was Viewed",t.listofNMIds.length)}catch(o){console.error("Error:",o)}})()}createLookUpNM(i,t){var o=this;return(0,b.Z)(function*(){o.api.GetLookupMasterTable(o.SK_clientID+"#notification_matrix",t).then(l=>{let a=[];if(null!=l&&l.items&&"string"==typeof l.items&&(a=JSON.parse(l.items)),null!=l&&a.length<o.maxlength){let r=[];l.items&&"string"==typeof l.items&&JSON.parse(l.items).forEach(m=>{for(const v in m)Object.prototype.hasOwnProperty.call(m,v)&&r.push(m[v])}),r.unshift(i),r=r.map((c,m)=>({[`L${m+1}`]:c})),console.log("newdata 11111111 :>> ",r);let s={PK:o.SK_clientID+"#notification_matrix",SK:l.SK,createdTime:"",updatedTime:"",items:JSON.stringify(r)};o.api.UpdateLookupMasterTable(s).then(function(){var c=(0,b.Z)(function*(m){console.log("createResponse :>> ",m),yield o.addFromService(),yield o.loading()});return function(m){return c.apply(this,arguments)}}()).catch(c=>{console.log("err :>> ",c)})}else if(null==l){let r=[];r.push(i),r=r.map((c,m)=>({[`L${m+1}`]:c}));let s={SK:t,PK:o.SK_clientID+"#notification_matrix",items:JSON.stringify(r)};o.api.CreateLookupMasterTable(s).then(function(){var c=(0,b.Z)(function*(m){yield o.addFromService(),yield o.loading()});return function(m){return c.apply(this,arguments)}}()).catch(c=>{})}else o.createLookUpNM(i,t+1)})})()}fetchNMById(i,t,o,l){var a=this;return(0,b.Z)(function*(){try{const r=yield a.api.GetLookupMasterTable(a.SK_clientID+"#notification_matrix",i);if(r&&r.items){let s=yield JSON.parse(r.items),c=s.findIndex(m=>m[Object.keys(m)[0]].P1===t);if(-1!==c){if("update"===o){s[c][`L${c+1}`]=l;const v=[];for(let N=0;N<s.length;N++){const _=Object.keys(s[N])[0],p=`L${N+1}`;if(_){const T={[p]:s[N][_]},D=v.findIndex(W=>Object.keys(W)[0]===p);-1!==D?Object.assign(v[D][p],s[N][_]):v.push(T)}else console.error(`Original key not found for renaming in data[${N}].`)}s=v}else"delete"===o&&(s.splice(c,1),console.log("Data after deleted deleted",s));let m={PK:a.SK_clientID+"#notification_matrix",SK:r.SK,items:JSON.stringify(s)};yield a.api.UpdateLookupMasterTable(m)}else yield new Promise(m=>setTimeout(m,500)),yield a.fetchNMById(i+1,t,o,l)}else Z().fire({position:"top-right",icon:"error",title:`ID ${t} not found`,showConfirmButton:!1,timer:1500})}catch(r){console.error("Error:",r)}})()}showDatatable(i){console.log(i,"GET VALUES"),i.sort((r,s)=>r[2]<s[2]?1:r[2]>s[2]?-1:0),console.log("SORTED:",i);let o="btn btn-sm btn-primary editdelete ",l="btn btn-sm btn-danger editdelete ";if(this.nm_table=[],typeof i<"u")for(let r=0;r<i.length;r++){let m=i[r][2];this.nm_table.push({PK:i[r][0],label:i[r][1],createdTime:new Date(1e3*m).toDateString()+" "+new Date(1e3*m).toLocaleTimeString()})}else this.nm_table=[];$("#datatables").off("click"),$("#datatables").on("click",".editdelete",function(){let r=$(this).closest("tr"),s=a.pbTableData.row(r);console.log("this.className",this.className),this.className==l&&(console.log("DELETE BUTTON CLICKED"),a.deleteNM(s.data()),console.log(s.data())),this.className==o&&(console.log("EDIT BUTTON CLICKLED"),a.hide_edit_delete("from_TS"),a.showSpinner(),a.openModal(s.data()),console.log(s.data()))}),!0===this.hideDeleteButton&&this.columnDatatable.push({defaultContent:"<button class='"+o+"'data-bs-target='#exampleModal' data-bs-toggle='modal' ><i class='fa fa-edit'></i></button>"},{defaultContent:"<button class='"+l+"'><i class='fa fa-trash'></i></button>"}),console.log("TABLE:",this.nm_table),console.log("COLUMN:",this.columnDatatable),this.getPbTableData(this.nm_table,this.columnDatatable),this.addFromService();let a=this;this.spinner.hide()}deleteNM(i){var t=this;if(console.log("inside delete",i),this.allPB_details=i,this.allPB_details&&this.allPB_details.PK){let l={PK:this.allPB_details.PK,SK:this.SK_clientID};var o=[this.allPB_details.PK,this.allPB_details.label,Math.ceil((new Date).getTime()/1e3)];Z().fire({position:"center",title:"Are you sure?",text:"You wont get these details back again",icon:"warning",showCancelButton:!0,allowOutsideClick:!1,confirmButtonText:"Yes, go ahead.",cancelButtonText:"No, let me think"}).then(function(){var a=(0,b.Z)(function*(r){r.dismiss!==Z().DismissReason.cancel?(console.log("Inside the deletion:"),yield t.fetchNMById(1,t.allPB_details.PK,"delete",o),console.log("DELETING FROM LOOKUP TABLE DONE"),console.log("NM id",l),t.api.DeleteNotificationMatrix(l).then(s=>{t.auditTrialServices.audit_trail("2.1","Notification Matrix","Delete",`"${l.PK}" NM config deleted`,"1"),t.addFromService(),t.loading(),console.log(s," REMOVED FROM MAIN TABLE"),s&&(console.log("confirmButtonText",s),Z().fire("Removed!","Notification Matrix Entry Removed Successfully.","success"))}).catch(s=>{})):r.dismiss===Z().DismissReason.cancel&&Z().fire("Cancelled","Notification Matrix Entry Not Removed","error")});return function(r){return a.apply(this,arguments)}}())}}hide_edit_delete(i){"from_html"===i?this.edit_delete=!this.edit_delete:"from_TS"===i&&(!1===this.hideDeleteButton?this.edit_delete=!1:!0===this.hideDeleteButton&&(this.edit_delete=!0))}showSpinner(){this.spinner.show(),this.stopTimer&&clearTimeout(this.stopTimer),setTimeout(()=>{this.spinner.hide()},1500)}changeDetection(){setTimeout(()=>{this.cd.detectChanges()},500)}getPbTableData(i,t){this.pbTableData=$("#datatables").DataTable({pagingType:"full_numbers",destroy:!0,lengthChange:!0,responsive:!0,data:i,order:[[3,"date"]],columnDefs:[{type:"date",targets:3}],columns:t}),this.cd.detectChanges()}loading(){var i=this;return(0,b.Z)(function*(){i.spinner.show(),$("datatables").DataTable().destroy(),i.nm_table=[],i.Lookupdata=[],yield i.fetchNMData(1),console.log("HIHIHIHIHIIHII"),console.log(i.Lookupdata)})()}initializePermissions(i){return this.fb.array(i.map(t=>this.fb.group({userID:[t.userID],enableSMS:[t.enableSMS],enableEmail:[t.enableEmail],enableTelegram:[t.enableTelegram],enableType1:[t.enableType1],enableType2:[t.enableType2],enableType3:[t.enableType3],enableType4:[t.enableType4],enableType5:[t.enableType5]})))}initializeLevels(i){const t=i.map((o,l)=>{const a=this.initializePermissions(o.permissions);return this.cd.detectChanges(),console.log("USERS:",o.users),this.fb.group({userIDs:[o.users],escalationTime:[o.escalationTime],comments:[o.comments],permissions:a})});return this.cd.detectChanges(),this.fb.array(t)}initializeForm(i,t){console.log("DATA FROM DB:",t);const o=this.initializeLevels(i);this.cd.detectChanges(),this.createNewField.setControl("levels",o),this.cd.detectChanges(),this.createNewField.patchValue({PK:t.PK,SK:t.SK,label:t.label,totalEscalationLevels:t.totalEscalationLevels,escalationTime:t.escalationTime,comments:t.comments,createdTime:t.createdTime,updatedTime:t.updatedTime}),this.cd.detectChanges()}}return d=h,(0,n.Z)(h,"\u0275fac",function(i){return new(i||d)(e.Y36(E.t),e.Y36(M.F),e.Y36(g.qu),e.Y36(C.F0),e.Y36(w.ux),e.Y36(M.F),e.Y36(U.t2),e.Y36(e.sBO),e.Y36(P.C))}),(0,n.Z)(h,"\u0275cmp",e.Xpm({type:d,selectors:[["app-configuration"]],viewQuery:function(i,t){if(1&i&&(e.Gf(L,5),e.Gf(A,5)),2&i){let o;e.iGM(o=e.CRH())&&(t.closeModal=o.first),e.iGM(o=e.CRH())&&(t.closeAlert=o.first)}},decls:59,vars:10,consts:[["id","exampleModal","data-bs-backdrop","static","tabindex","-1","role","dialog","aria-labelledby","exampleModal","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content",2,"width","1200px","transform","translate(-27%, 0px)"],[1,"modal-header"],["class","modal-title","id","exampleModalLabel",4,"ngIf"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"fv-row",3,"formGroup"],[1,"card-body","border-top","p-9"],[1,"container"],[1,"row"],[1,"col-md-4"],[1,"col-lg-12","col-form-label","fw-bold","fs-6","required"],["type","text","placeholder","Enter ID","name","id","formControlName","PK","required","",1,"form-control","form-control-lg","form-control-solid","mb-3","mb-lg-0",3,"keyup"],[2,"color","#fc1900"],["class","fv-plugins-message-container invalid-feedback",4,"ngIf"],["type","text","min","1","placeholder","Enter label","name","model","formControlName","label",1,"form-control","form-control-lg","form-control-solid","mb-3","mb-lg-0"],["min","1","max","10","placeholder","Enter Total Escalation Levels","name","description","type","number","formControlName","totalEscalationLevels",1,"form-control","form-control-lg","form-control-solid","mb-3","mb-lg-0",3,"change","keyup","wheel"],["formArrayName","levels",4,"ngIf"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-sm","btn-danger"],["closeModal",""],["type","submit","class","btn btn-sm btn-primary",3,"hidden","disabled","click",4,"ngIf"],["type","button","class","btn btn-sm btn-primary not-allowed",3,"disabled","click",4,"ngIf"],[1,"card","mb-5","mb-xl-8"],[1,"card-header","border-0","pt-5"],[1,"card-title","align-items-start","flex-column"],[1,"card-label","fw-bolder","fs-3","mb-1"],[1,"card-toolbar"],["type","button","data-bs-toggle","modal","data-bs-target","#exampleModal",1,"btn","btn-sm","btn-primary",3,"click"],[1,"card-body","py-3"],[1,"table-responsive"],["id","datatables",1,"table","table-row-dashed","table-row-gray-300","align-middle","gs-0","gy-4"],["id","exampleModalLabel",1,"modal-title"],[1,"fv-plugins-message-container","invalid-feedback"],["formArrayName","levels"],[3,"formGroupName",4,"ngFor","ngForOf"],[3,"formGroupName"],[1,"custom-multiselect"],["formControlName","userIDs","required","",1,"form-select","form-select-solid","form-select-lg","fw-bold",2,"display","inline-block","width","100%","padding","0px","margin-bottom","0","font-weight","0px","line-height","1.52857143","text-align","left","vertical-align","middle","cursor","pointer","background-image","none","border-radius","4px",3,"placeholder","settings","data","onSelect","onDeSelect","onSelectAll","onDeSelectAll"],["type","text","min","1","placeholder","Enter Escalation Time","name","model","formControlName","escalationTime","required","",1,"form-control","form-control-lg","form-control-solid","mb-3","mb-lg-0"],["type","text","min","1","placeholder","Enter Escalation Level Comment","name","model","formControlName","comments","required","",1,"form-control","form-control-lg","form-control-solid","mb-3","mb-lg-0"],["formArrayName","permissions"],[1,"col-lg-12","col-form-label","fw-bold","fs-6"],[1,"w-125px"],[1,"form-check","form-check-solid"],["type","checkbox","formControlName","enableSMS",1,"form-check-input"],["type","checkbox","formControlName","enableEmail",1,"form-check-input"],["type","checkbox","formControlName","enableTelegram",1,"form-check-input"],["type","checkbox","formControlName","enableType1",1,"form-check-input"],["type","checkbox","formControlName","enableType2",1,"form-check-input"],["type","checkbox","formControlName","enableType3",1,"form-check-input"],["type","checkbox","formControlName","enableType4",1,"form-check-input"],["type","checkbox","formControlName","enableType5",1,"form-check-input"],["type","submit",1,"btn","btn-sm","btn-primary",3,"hidden","disabled","click"],["type","button",1,"btn","btn-sm","btn-primary","not-allowed",3,"disabled","click"]],template:function(i,t){if(1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),e.YNc(4,F,2,0,"h2",4),e.YNc(5,K,2,0,"h2",4),e._UZ(6,"button",5),e.qZA(),e.TgZ(7,"div",6)(8,"div",7)(9,"div",8)(10,"div",9)(11,"div",10)(12,"label",11),e._uU(13," Notification Matrix ID"),e.qZA(),e.TgZ(14,"input",12),e.NdJ("keyup",function(){let l;return t.checkUniqueID(null==(l=t.createNewField.get("PK"))?null:l.value)}),e.qZA(),e.TgZ(15,"span",13),e._uU(16),e.qZA(),e.YNc(17,k,2,0,"div",14),e.qZA(),e.TgZ(18,"div",10)(19,"label",11),e._uU(20,"Label"),e.qZA(),e._UZ(21,"input",15),e.qZA(),e.TgZ(22,"div",10)(23,"label",11),e._uU(24,"Total Escalation Levels (Min : 1; Max : 10)"),e.qZA(),e.TgZ(25,"input",16),e.NdJ("change",function(l){return t.onTotalEscalationLevelsChange(l)})("keyup",function(l){return t.onTotalEscalationLevelsChange(l)})("wheel",function(l){return t.disableScroll(l)}),e.qZA(),e.YNc(26,q,2,0,"div",14),e.qZA()()(),e.TgZ(27,"div",8),e.YNc(28,B,2,1,"div",17),e.YNc(29,R,2,0,"div",14),e.qZA()()(),e.TgZ(30,"div",18)(31,"button",19,20),e._uU(33,"Cancel"),e.qZA(),e.YNc(34,G,2,3,"button",21),e.YNc(35,Y,2,1,"button",22),e.qZA()()()(),e.TgZ(36,"div",23)(37,"div",24)(38,"h3",25)(39,"span",26),e._uU(40," Notification Matrix configuration"),e.qZA()(),e.TgZ(41,"div",27)(42,"button",28),e.NdJ("click",function(){return t.openModal("")}),e._uU(43," New "),e.qZA()()(),e.TgZ(44,"div",29)(45,"div",30)(46,"table",31)(47,"thead")(48,"tr")(49,"th"),e._uU(50,"Notification Matrix ID"),e.qZA(),e.TgZ(51,"th"),e._uU(52,"Label"),e.qZA(),e.TgZ(53,"th"),e._uU(54,"Updated"),e.qZA(),e.TgZ(55,"th"),e._uU(56,"Edit"),e.qZA(),e.TgZ(57,"th"),e._uU(58,"Delete"),e.qZA()()()()()()()),2&i){let o,l,a;e.xp6(4),e.Q6J("ngIf",t.showHeading),e.xp6(1),e.Q6J("ngIf",!t.showHeading),e.xp6(2),e.Q6J("formGroup",t.createNewField),e.xp6(9),e.Oqu(t.errorForUniqueLabel),e.xp6(1),e.Q6J("ngIf",(null==(o=t.createNewField.get("id"))?null:o.hasError("required"))&&(null==(o=t.createNewField.get("id"))?null:o.touched)),e.xp6(9),e.Q6J("ngIf",(null==(l=t.createNewField.get("totalEscalationLevels"))?null:l.hasError("required"))&&(null==(l=t.createNewField.get("totalEscalationLevels"))?null:l.touched)||t.totEscLvl),e.xp6(2),e.Q6J("ngIf",null==t.levels?null:t.levels.length),e.xp6(1),e.Q6J("ngIf",(null==(a=t.createNewField.get("users"))?null:a.hasError("required"))&&(null==(a=t.createNewField.get("users"))?null:a.touched)),e.xp6(5),e.Q6J("ngIf",t.showModal),e.xp6(1),e.Q6J("ngIf",!t.showModal)}},dependencies:[y.sg,y.O5,g.Fj,g.wV,g.Wl,g.JJ,g.JL,g.Q7,g.qQ,g.Fd,g.sg,g.u,g.x0,g.CE,S.O],styles:[".btn-close{background-color:#f1416c}\n"],encapsulation:2})),h})();var Q=f(627),z=f(17700),j=f(85722),V=f(70053);let X=(()=>{var d;class h{}return d=h,(0,n.Z)(h,"\u0275fac",function(i){return new(i||d)}),(0,n.Z)(h,"\u0275mod",e.oAB({type:d})),(0,n.Z)(h,"\u0275inj",e.cJS({imports:[y.ez,g.u5,g.UX,Q.T,z.Is,w.ZX,j.ii,V.vi,S.Z.forRoot(),C.Bz.forChild([{path:"",component:H}])]})),h})()}}]);