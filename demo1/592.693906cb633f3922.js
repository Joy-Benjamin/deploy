"use strict";(self.webpackChunkdemo1=self.webpackChunkdemo1||[]).push([[592],{70592:(pe,k,g)=>{g.r(k),g.d(k,{CompanyModule:()=>te});var m=g(86656),D=g(96814),x=g(22939),w=g(64190),_=g(15861),d=g(56223),S=g(13519),b=g.n(S),e=g(65879),U=g(5588),F=g(31552),q=g(6593),N=g(16519),A=g(78325),P=g(14934);const M=["closeCompany"];function L(c,u){if(1&c){const p=e.EpF();e.TgZ(0,"button",64),e.NdJ("click",function(){e.CHM(p);const o=e.oxw();return e.KtG(o.openModal(""))}),e._uU(1," New "),e.qZA()}}function J(c,u){1&c&&(e.TgZ(0,"tr")(1,"th"),e._uU(2,"Company ID"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Client ID"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Updated"),e.qZA(),e.TgZ(7,"th"),e._uU(8,"Edit"),e.qZA(),e.TgZ(9,"th"),e._uU(10,"Delete"),e.qZA()())}function E(c,u){1&c&&(e.TgZ(0,"tr")(1,"th"),e._uU(2,"Company ID"),e.qZA(),e.TgZ(3,"th"),e._uU(4,"Client ID"),e.qZA(),e.TgZ(5,"th"),e._uU(6,"Updated"),e.qZA(),e.TgZ(7,"th"),e._uU(8,"Edit"),e.qZA()())}function K(c,u){1&c&&(e.TgZ(0,"h2",65),e._uU(1,"Add Company Configuration"),e.qZA())}function B(c,u){1&c&&(e.TgZ(0,"h2",65),e._uU(1,"Edit Company Configuration"),e.qZA())}function O(c,u){if(1&c&&e._UZ(0,"img",66),2&c){const p=e.oxw();e.s9C("src",p.base64textString_temp,e.LSH)}}function Q(c,u){if(1&c&&e._UZ(0,"img",66),2&c){const p=e.oxw();e.s9C("src",p.base64textString_temp_logo1,e.LSH)}}function G(c,u){1&c&&(e.TgZ(0,"div",67),e._uU(1," Company ID is required "),e.qZA())}function Y(c,u){1&c&&(e.TgZ(0,"div",67),e._uU(1," clientID is required "),e.qZA())}function z(c,u){1&c&&(e.TgZ(0,"div",67),e._uU(1," Company Name is required "),e.qZA())}function H(c,u){1&c&&(e.TgZ(0,"div",67),e._uU(1," Company Desc is required "),e.qZA())}function R(c,u){1&c&&(e.TgZ(0,"div",67),e._uU(1," Mobile number is required "),e.qZA())}function j(c,u){1&c&&(e.TgZ(0,"div",67),e._uU(1," Email is required "),e.qZA())}function W(c,u){if(1&c){const p=e.EpF();e.ynx(0),e.TgZ(1,"div",68),e._uU(2," \xa0 "),e._UZ(3,"input",69),e._uU(4," \xa0 "),e._UZ(5,"input",70),e._uU(6," \xa0 "),e.TgZ(7,"button",71),e.NdJ("click",function(){const a=e.CHM(p).index,i=e.oxw();return e.KtG(i.remove(a))}),e._UZ(8,"span",72),e.qZA(),e._uU(9," \xa0 "),e.qZA(),e.BQk()}if(2&c){const p=u.index;e.xp6(1),e.Q6J("formGroupName",p),e.xp6(7),e.Q6J("inlineSVG","./assets/media/icons/duotune/arrows/arr061.svg")}}function X(c,u){if(1&c){const p=e.EpF();e.TgZ(0,"button",73),e.NdJ("click",function(){e.CHM(p);const o=e.oxw();return e.KtG(o.updateCompany(o.createCompanyField.value,"editCompany"))}),e._uU(1," Update "),e.qZA()}if(2&c){const p=e.oxw();e.Q6J("hidden",p.hideUpdateButton)("disabled",p.createCompanyField.invalid||"Company ID already exists"==p.errorForUniqueID||"Invalid Email Address"==p.errorForInvalidEmail)("disabled",!p.createCompanyField.dirty||p.createCompanyField.invalid)}}function V(c,u){if(1&c){const p=e.EpF();e.TgZ(0,"button",74),e.NdJ("click",function(){e.CHM(p);const o=e.oxw();return e.KtG(o.createNewCompany(""))}),e._uU(1,"Save"),e.qZA()}if(2&c){const p=e.oxw();e.Q6J("disabled",p.createCompanyField.invalid||"Company ID already exists"==p.errorForUniqueID||"Invalid Email Address"==p.errorForInvalidEmail)}}let ee=(()=>{var c;class u{constructor(t,o,a,i,r,l,s,n){(0,m.Z)(this,"fb",void 0),(0,m.Z)(this,"companyConfiguration",void 0),(0,m.Z)(this,"api",void 0),(0,m.Z)(this,"toast",void 0),(0,m.Z)(this,"sanitizer",void 0),(0,m.Z)(this,"router",void 0),(0,m.Z)(this,"cd",void 0),(0,m.Z)(this,"auditTrialServices",void 0),(0,m.Z)(this,"createCompanyField",void 0),(0,m.Z)(this,"showModal",!1),(0,m.Z)(this,"showHeading",!1),(0,m.Z)(this,"errorForUniqueID",void 0),(0,m.Z)(this,"errorForMobile",void 0),(0,m.Z)(this,"logo1_name",void 0),(0,m.Z)(this,"base64textString",void 0),(0,m.Z)(this,"base64textString_temp",void 0),(0,m.Z)(this,"base64textString_logo1",void 0),(0,m.Z)(this,"base64textString_temp_logo1",void 0),(0,m.Z)(this,"allCompanyDetails",{}),(0,m.Z)(this,"getLoggedUser",void 0),(0,m.Z)(this,"SK_clientID",void 0),(0,m.Z)(this,"loggedUser_Company",void 0),(0,m.Z)(this,"defaultLocation",{}),(0,m.Z)(this,"errorForInvalidEmail",void 0),(0,m.Z)(this,"jsondata",[{id:"node1",parent:"#",text:"World",node_type:"location",area:null,summary_enable:null,summary_types:null,dashboard_view:{id:null},leadership_view:{id:null},mobile_view:{id:null}},{id:"node2",parent:"node1",text:"Asia",node_type:"location",area:null,summary_enable:null,summary_types:null,dashboard_view:{id:null},leadership_view:{id:null},mobile_view:{id:null}},{id:"India",parent:"node2",text:"India",node_type:"location",area:null,summary_enable:null,summary_types:null,dashboard_view:{id:null},leadership_view:{id:null},mobile_view:{id:null}}]),(0,m.Z)(this,"closeCompany",void 0),(0,m.Z)(this,"data_temp",[]),(0,m.Z)(this,"listofSK",[]),(0,m.Z)(this,"companySK",void 0),(0,m.Z)(this,"allPermissions_user",void 0),(0,m.Z)(this,"hideUpdateButton",!1),(0,m.Z)(this,"hideDeleteButton",!1),(0,m.Z)(this,"columnDatatable",[]),(0,m.Z)(this,"clientID",void 0),(0,m.Z)(this,"dataform",[]),(0,m.Z)(this,"lookup_data_user",[]),(0,m.Z)(this,"columnTableData",[]),(0,m.Z)(this,"deviceTableData",void 0),(0,m.Z)(this,"maxlength",500),this.fb=t,this.companyConfiguration=o,this.api=a,this.toast=i,this.sanitizer=r,this.router=l,this.cd=s,this.auditTrialServices=n}ngOnInit(){this.getLoggedUser=this.companyConfiguration.getLoggedUserDetails(),this.SK_clientID=this.getLoggedUser.attributes["custom:clientID"],this.loggedUser_Company=this.getLoggedUser.attributes["custom:companyID"],this.clientID=this.getLoggedUser.attributes["custom:clientID"]+"#company",console.log("Mater Client iD is :",this.clientID),this.allPermissions_user=JSON.parse(JSON.parse(JSON.stringify(localStorage.getItem("permissionDetails")))),this.addFromService(),this.initializeCompanyFields(),this.loading(),this.auditTrialServices.audit_trail("2.1","Client","Page Load","Company Page Loaded","1")}loading(){$("#datatables").DataTable().destroy(),this.dataform=[],this.lookup_data_user=[],this.fetchTMLookupData(1)}fetchTMLookupData(t){var o=this;return(0,_.Z)(function*(){console.log("Iam called Bro");try{const a=yield o.api.GetLookupMasterTable(o.clientID,t);if(a&&a.items)if("string"==typeof a.items){let i=JSON.parse(a.items);if(console.log("d1 =",i),Array.isArray(i)){for(let r=0;r<i.length;r++){const l=i[r];if(null==l)break;{const s=Object.keys(l)[0],{P1:n,P2:h,P3:f}=l[s];o.lookup_data_user.push({P1:n,P2:h,P3:f}),console.log("d2 =",o.lookup_data_user)}}o.lookup_data_user.sort((r,l)=>l.P3-r.P3),console.log("Lookup sorting",o.lookup_data_user),yield o.auditTrialServices.audit_trail("2.1","Company","View","Company Table was viewed",o.lookup_data_user.length),yield o.fetchTMLookupData(t+1)}else console.error("Invalid data format - not an array.")}else console.error("response.listOfItems is not a string.");else console.log(),console.log("Permissions to be displayed",o.lookup_data_user),o.getTableUser(o.lookup_data_user)}catch(a){console.error("Error:",a)}})()}getTableUser(t){let o="btn btn-sm btn-primary editclasscompany ",a="btn btn-sm btn-danger editclasscompany ";if(typeof t<"u")for(let l=0;l<t.length;l++)this.dataform.push({company_id:t[l].P1,client_id:t[l].P2,updatedTime:new Date(1e3*t[l].P3).toDateString()+" "+new Date(1e3*t[l].P3).toLocaleTimeString()});else this.dataform=[];let i=[];if(typeof t<"u")for(let l=0;l<t.length;l++)i[l]=new Date(t[l].updatedTime).toLocaleString(),t[l].updatedTime=i[l];else t=[];!0===this.hideDeleteButton?this.columnTableData.push({defaultContent:"<button class='"+o+"' data-bs-target='#companyModal' data-bs-toggle='modal'><i class='fa fa-edit'></i></i></button>"},{defaultContent:"<button class='"+a+"'><i class='fa fa-trash'></i></button>"}):this.columnTableData.push({defaultContent:"<button class='"+o+"' data-bs-target='#companyModal' data-bs-toggle='modal''><i class='fa fa-edit'></i></i></button>"}),console.log("columnDatatable",this.columnTableData),console.log("dataform",this.dataform),$("#company_lookup_table").off("click"),$("#company_lookup_table").on("click",".editclasscompany",function(){let l=$(this).closest("tr"),s=r.deviceTableData.row(l);this.className==a&&r.deleteCompany(s.data()),this.className==o&&r.openModalHelpher(s.data())}),this.getLookupTableData(this.dataform,this.columnTableData),this.addFromService();let r=this}openModalHelpher(t){console.log("Data from llokup :",t),this.api.GetCompany(t.company_id,this.SK_clientID).then(o=>{o&&void 0!==o&&o&&this.openModal(o)}).catch(o=>{console.log("cant fetch",o)})}getLookupTableData(t,o){var a=this;return(0,_.Z)(function*(){console.log("chk1 tm",t),console.log("chk2 tm",o);try{a.deviceTableData&&$.fn.DataTable.isDataTable("#company_lookup_table")&&a.deviceTableData.destroy(),a.deviceTableData=$("#company_lookup_table").DataTable({pagingType:"full_numbers",destroy:!0,lengthChange:!0,responsive:!0,data:t,ordering:!0,order:[[3,"asc"]],columnDefs:[{type:"date",targets:3}],columns:o})}catch(i){console.error("Error initializing DataTable:",i)}})()}addFromService(){this.columnDatatable=[],this.columnTableData=[],this.columnDatatable=[{data:"companyID"},{data:"clientID"},{data:"companyDesc"},{data:"mobile"},{data:"emailID"},{data:"updated"}],this.columnTableData=[{data:"company_id"},{data:"client_id"},{data:"updatedTime"}],this.checkPermission(),this.companyConfiguration.getSpecificCompany(this.SK_clientID).then(t=>{if(t&&void 0!==t){this.data_temp=t,this.listofSK=[];for(let o=0;o<t.length;o++)this.listofSK.push(t[o]?.PK)}(null==t||null==t)&&(this.data_temp=t)}).catch(t=>{console.log("cant fetch",t)})}checkPermission(){let t=!1,o=!1;for(let a=0;a<this.allPermissions_user.length;a++)"Company - Update"===this.allPermissions_user[a]?t=!0:"Company - View"===this.allPermissions_user[a]&&(o=!0);t&&o||t?this.hideDeleteButton=!0:o?this.hideDeleteButton=!1:this.router.navigate(["/404"])}initializeCompanyFields(){this.createCompanyField=this.fb.group({logo1:[""],logo2:[""],clientID:["",d.kI.required],companyID:["",d.kI.required],companyName:["",d.kI.required],companydesc:["",d.kI.required],mobile:["",d.kI.required],email_permission:["",d.kI.required],sms_permission:["",d.kI.required],telegram_permission:["",d.kI.required],health_permission:["",d.kI.required],device_permission:["",d.kI.required],alert_permission:["",d.kI.required],email:["",[d.kI.required,d.kI.email]],telegramID:["",d.kI.required],enableCompany:["",d.kI.required],metadata:this.fb.array([this.createItem()])})}metadata(){return this.createCompanyField.get("metadata")}add(){this.metadata().push(this.createItem())}createItem(){return this.fb.group({key:new d.p4("",[d.kI.required]),value:new d.p4("",[d.kI.required])})}updateItem(t){this.metadata().clear();for(let o=0;o<t.length;o++)this.metadata().push(this.fb.group({key:t[o].key,value:t[o].value}));return this.metadata()}remove(t){console.log("remove",t),this.createCompanyField.get("metadata").removeAt(t)}checkUniqueIdentifier(t){console.log("getID",t),this.errorForUniqueID="";for(let o=0;o<this.listofSK.length;o++)t.target.value==this.listofSK[o]&&(this.errorForUniqueID="Company ID already exists")}openModal(t){if(console.log("getvalues inside openModal",t),""==t)this.showHeading=!0,this.showModal=!1,this.errorForUniqueID="",this.errorForInvalidEmail="",this.base64textString_temp="",this.base64textString_temp_logo1="",this.createCompanyField.get("companyID")?.enable(),this.createCompanyField=this.fb.group({logo1:t.logo1,logo2:t.logo2,clientID:t.clientID,companyID:t.companyID,companyName:t.companyName,companydesc:t.companyDesc,mobile:t.mobile,email_permission:t.email,sms_permission:t.sms,telegram_permission:t.telegram,health_permission:t.healthCheck,alert_permission:t.alert_permission,enableCompany:t.enableCompany,device_permission:t.device_permission,email:t.email,telegramID:t.telegramID,metadata:this.fb.array([])});else if(t){console.log("get values on edit"),this.createCompanyField.get("companyID")?.disable();for(let i=0;i<this.allPermissions_user.length;i++){if("Company - Update"===this.allPermissions_user[i]){this.hideUpdateButton=!1;break}"Company - View"===this.allPermissions_user[i]&&(this.hideUpdateButton=!0)}this.showHeading=!1,this.showModal=!0,this.base64textString_temp=t.logo1,this.base64textString_temp_logo1=t.logo2,this.errorForUniqueID="",this.errorForInvalidEmail="";let a="";t.metadata&&(a=JSON.parse(t.metadata)),this.createCompanyField=this.fb.group({logo1:t.logo1,logo2:t.logo2,clientID:{value:t.clientID,disabled:!0},companyID:{value:t.companyID,disabled:!0},companyName:t.companyName,companydesc:t.companyDesc,mobile:t.mobile,email_permission:t.email,sms_permission:t.sms,telegram_permission:t.telegram,health_permission:t.healthCheck,alert_permission:t.alert_permission,device_permission:t.deviceTimeout,email:t.emailID,telegramID:t.telegramID,enableCompany:t.enableCompany,metadata:this.updateItem(a)}),this.auditTrialServices.audit_trail("2.1","Company","View",`${this.createCompanyField.get("companyID")?.value} Company was viewed`,"1")}this.cd.detectChanges()}firstLogoCompany(t){console.log("image",t),this.base64textString_temp=t;let o=t.target.files,a=o[0],i=a.type;if("image/gif"==i||"image/png"==i||"image/bmp"==i||"image/jpeg"==i||"image/jpg"==i){if(o&&a){let r=new FileReader;r.onload=this.firstbase64.bind(this),r.readAsBinaryString(a)}}else b().fire({customClass:{container:"swal2-container"},position:"center",text:"Image type should be only of GIF, PNG, JPG, JPEG and BMP",icon:"warning",showCancelButton:!0,allowOutsideClick:!1})}secondLogoCompany(t){console.log("image",t),this.base64textString_temp_logo1=t;let o=t.target.files,a=o[0],i=a.type;if("image/gif"==i||"image/png"==i||"image/bmp"==i||"image/jpeg"==i||"image/jpg"==i){if(o&&a){let r=new FileReader;r.onload=this.secondbase64.bind(this),r.readAsBinaryString(a)}}else b().fire({customClass:{container:"swal2-container"},position:"center",text:"Image type should be only of GIF, PNG, JPG, JPEG and BMP",icon:"warning",showCancelButton:!0,allowOutsideClick:!1})}firstbase64(t){console.log("readerEvt",t),this.base64textString=btoa(t.target.result);let i=this.base64textString_temp.target.files[0],r=i.type;this.logo1_name=i.name;let n=1;"="==this.base64textString[this.base64textString.length-1]&&"="==this.base64textString[this.base64textString.length-2]&&(n=2);let h=this.base64textString.length*(3/4)-n;if(h/=1e3,!(h<200))return b().fire({customClass:{container:"swal2-container"},position:"center",text:"Image should be less than 200KB",icon:"warning",showCancelButton:!0,allowOutsideClick:!1});this.base64textString_temp="data:"+r+";base64,"+this.base64textString}secondbase64(t){this.base64textString_logo1=btoa(t.target.result);let r=this.base64textString_temp_logo1.target.files[0].type,s=1;"="==this.base64textString_logo1[this.base64textString_logo1.length-1]&&"="==this.base64textString_logo1[this.base64textString_logo1.length-2]&&(s=2);let n=this.base64textString_logo1.length*(3/4)-s;if(n/=1e3,!(n<200))return b().fire({customClass:{container:"swal2-container"},position:"center",text:"Image should be less than 200KB",icon:"warning",showCancelButton:!0,allowOutsideClick:!1});this.base64textString_temp_logo1="data:"+r+";base64,"+this.base64textString_logo1}keyPress(t){let a=String.fromCharCode(t.charCode);console.log("inputChar",a),8!=t.keyCode&&!/[0-9\+\-\ ]/.test(a)&&t.preventDefault()}checkMail(t){console.log("event",t),this.errorForInvalidEmail="",0==/^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.(aero|arpa|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro|travel|mobi|[a-z][a-z])|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i.test(t.target.value)&&(this.errorForInvalidEmail="Invalid Email Address")}getDatatable(t){console.log("inside get datatble",t);let o=[],a=[];if(typeof t<"u"){for(let n=0;n<t.length;n++)a[n]=new Date(t[n].updated).toLocaleString(),t[n].updated=a[n];for(let n=0;n<t.length;n++)o.push({companyID:t[n].PK,clientID:t[n].clientID,companyDesc:t[n].companyDesc,companyName:t[n].companyName,deviceTimeout:t[n].deviceTimeout,email:t[n].email,emailID:t[n].emailID,enableCompany:t[n].enableCompany,healthCheck:t[n].healthCheck,mobile:t[n].mobile,sms:t[n].sms,telegram:t[n].telegram,alert_permission:t[n].alertTimeout,telegramID:t[n].telegramID,logo1:t[n].companyLogo1,logo2:t[n].companyLogo2,metadata:t[n].metadata,updated:t[n].updated})}else o=[];let i="btn btn-sm btn-primary editdelete ",r="btn btn-sm btn-danger editdelete ";$("#company_configuration").off("click"),$("#company_configuration").on("click",".editdelete",function(){let n=$(this).closest("tr"),h=l.row(n);this.className==r?s.deleteCompany(h.data()):this.className==i&&s.openModal(h.data())}),!0===this.hideDeleteButton?this.columnDatatable.push({defaultContent:"<button class='"+i+"' data-bs-target='#companyModal' data-bs-toggle='modal'><i class='fa fa-edit'></i></button>"},{defaultContent:"<button class='"+r+"'><i class='fa fa-trash'></i></button>"}):this.columnDatatable.push({defaultContent:"<button class='"+i+"' data-bs-target='#companyModal' data-bs-toggle='modal'><i class='fa fa-edit'></i></button>"});let l=$("#company_configuration").DataTable({pagingType:"full_numbers",destroy:!0,lengthChange:!1,responsive:!0,data:o,columns:this.columnDatatable}),s=this}createNewCompany(t){var o=this;let a=this.createCompanyField.value.clientID.trim()+"#company";this.allCompanyDetails={PK:this.createCompanyField.value.companyID.trim(),SK:this.createCompanyField.value.clientID.trim(),companyID:this.createCompanyField.value.companyID.trim(),clientID:this.createCompanyField.value.clientID.trim(),companyName:this.createCompanyField.value.companyName.trim(),companyDesc:this.createCompanyField.value.companydesc,enableCompany:this.createCompanyField.value.enableCompany,mobile:this.createCompanyField.value.mobile,emailID:this.createCompanyField.value.email,email:this.createCompanyField.value.email_permission,sms:this.createCompanyField.value.sms_permission,telegram:this.createCompanyField.value.telegram_permission,healthCheck:this.createCompanyField.value.health_permission,deviceTimeout:this.createCompanyField.value.device_permission,alertTimeout:this.createCompanyField.value.alert_permission,telegramID:this.createCompanyField.value.telegramID,companyLogo1:this.base64textString_temp,companyLogo2:this.base64textString_temp_logo1,metadata:JSON.stringify(this.createCompanyField.value.metadata),updated:new Date};const i=Math.ceil((new Date).getTime()/1e3),r={P1:this.allCompanyDetails.PK,P2:this.allCompanyDetails.SK,P3:i};this.api.CreateCompany(this.allCompanyDetails).then(function(){var l=(0,_.Z)(function*(s){o.auditTrialServices.audit_trail("2.1","Company","Create",`${o.allCompanyDetails.PK} Company was created`,"1"),yield o.createLookUpRdt(r,1,a),yield o.loading(),o.addFromService(),s?(o.toast.open("New Company Configuration created successfully"," ",{duration:2e3,horizontalPosition:"right",verticalPosition:"top"}),o.closeCompany.nativeElement.click(),o.defaultLocation={PK:o.createCompanyField.value.companyID.trim(),SK:o.createCompanyField.value.clientID.trim(),tree:JSON.stringify(o.jsondata)},o.api.CreateLocation(o.defaultLocation).then(n=>{n?o.toast.open("New Location Configuration created successfully"," ",{duration:2e3,horizontalPosition:"right",verticalPosition:"top"}):b().fire({customClass:{container:"swal2-container"},position:"center",icon:"warning",title:"Error in adding Location Configuration",showCancelButton:!0,allowOutsideClick:!1})}).catch(n=>{console.log("err for creation",n),o.toast.open("Error in adding new Location Configuration ","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"})})):b().fire({customClass:{container:"swal2-container"},position:"center",icon:"warning",title:"Error in adding Company Configuration",showCancelButton:!0,allowOutsideClick:!1})});return function(s){return l.apply(this,arguments)}}()).catch(l=>{console.log("err for creation",l),this.toast.open("Error in adding new company Configuration ","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"})})}createLookUpRdt(t,o,a){var i=this;return(0,_.Z)(function*(){try{console.log("iam a calleddd dude",t,o);const r=yield i.api.GetLookupMasterTable(a,o);let l=[];if(null!=r&&r.items&&"string"==typeof r.items&&(l=JSON.parse(r.items)),null!=r&&l.length<i.maxlength){let s=[];r.items&&"string"==typeof r.items&&JSON.parse(r.items).forEach(y=>{for(const C in y)Object.prototype.hasOwnProperty.call(y,C)&&s.push(y[C])}),s.unshift(t),s=s.map((f,y)=>({[`L${y+1}`]:f})),console.log("newdata 11111111 :>> ",s);let n={PK:a,SK:r.SK,createdTime:"",updatedTime:"",items:JSON.stringify(s)};const h=yield i.api.UpdateLookupMasterTable(n);console.log("createResponse :>> ",h)}else if(null==r){let s=[];s.push(t),s=s.map((f,y)=>({[`L${y+1}`]:f}));let n={SK:o,PK:a,items:JSON.stringify(s)};console.log(n);const h=yield i.api.CreateLookupMasterTable(n);console.log(h)}else yield i.createLookUpRdt(t,o+1,a)}catch(r){console.log("err :>> ",r)}})()}updateCompany(t,o){var a=this;"editCompany"==o&&(this.allCompanyDetails={PK:this.createCompanyField.get("companyID")?.value,SK:this.createCompanyField.get("clientID")?.value,companyID:this.createCompanyField.get("companyID")?.value,clientID:this.createCompanyField.get("clientID")?.value,companyName:this.createCompanyField.value.companyName,companyDesc:this.createCompanyField.value.companydesc,enableCompany:this.createCompanyField.value.enableCompany,mobile:this.createCompanyField.value.mobile,emailID:this.createCompanyField.value.email,email:this.createCompanyField.value.email_permission,sms:this.createCompanyField.value.sms_permission,telegram:this.createCompanyField.value.telegram_permission,healthCheck:this.createCompanyField.value.health_permission,deviceTimeout:this.createCompanyField.value.device_permission,alertTimeout:this.createCompanyField.value.alert_permission,telegramID:this.createCompanyField.value.telegramID,companyLogo1:this.base64textString_temp,companyLogo2:this.base64textString_temp_logo1,metadata:JSON.stringify(this.createCompanyField.value.metadata),updated:new Date}),console.log("after updating",this.allCompanyDetails);const i=Math.ceil((new Date).getTime()/1e3),r={P1:this.allCompanyDetails.PK,P2:this.allCompanyDetails.SK,P3:i};this.api.UpdateCompany(this.allCompanyDetails).then(function(){var l=(0,_.Z)(function*(s){s?(a.auditTrialServices.audit_trail("2.1","Company","Update",`${a.allCompanyDetails.PK} Company was updated`,"1"),yield a.fetchTimeMachineById(1,a.allCompanyDetails.PK,"update",r),yield a.loading(),a.toast.open("Company Configuration updated successfully","",{duration:2e3,horizontalPosition:"right",verticalPosition:"top"}),a.addFromService(),a.closeCompany.nativeElement.click()):alert("Error in updating Company Configuration")});return function(s){return l.apply(this,arguments)}}()).catch(l=>{console.log("error for updating",l)})}fetchTimeMachineById(t,o,a,i){var r=this;return(0,_.Z)(function*(){try{const l=yield r.api.GetLookupMasterTable(r.clientID,t);if(l&&l.items){let s=yield JSON.parse(l.items),n=s.findIndex(h=>h[Object.keys(h)[0]].P1===o);if(-1!==n){if("update"===a){s[n][`L${n+1}`]=i;const f=[];for(let y=0;y<s.length;y++){const C=Object.keys(s[y])[0],v=`L${y+1}`;if(C){const I={[v]:s[y][C]},Z=f.findIndex(T=>Object.keys(T)[0]===v);-1!==Z?Object.assign(f[Z][v],s[y][C]):f.push(I)}else console.error(`Original key not found for renaming in data[${y}].`)}s=f}else"delete"===a&&s.splice(n,1);let h={PK:r.clientID,SK:l.SK,items:JSON.stringify(s)};yield r.api.UpdateLookupMasterTable(h)}else yield new Promise(h=>setTimeout(h,500)),yield r.fetchTimeMachineById(t+1,o,a,i)}else b().fire({position:"top-right",icon:"error",title:`ID ${o} not found`,showConfirmButton:!1,timer:1500})}catch(l){console.error("Error:",l)}})()}deleteCompany(t){var o=this;this.companySK=t,console.log("Delete this :",t),this.companySK&&this.companySK.company_id&&(this.allCompanyDetails={PK:this.companySK.company_id,SK:this.companySK.client_id},console.log("All company Details :",this.allCompanyDetails),b().fire({position:"center",title:"Are you sure?",text:"You wont get these details back again",icon:"warning",showCancelButton:!0,allowOutsideClick:!1,confirmButtonText:"Yes, go ahead.",cancelButtonText:"No, let me think"}).then(a=>{if(a.dismiss!==b().DismissReason.cancel){const i=Math.ceil((new Date).getTime()/1e3),r={P1:this.companySK.company_id,P2:this.companySK.client_id,P3:i};this.api.DeleteCompany(this.allCompanyDetails).then(function(){var l=(0,_.Z)(function*(s){o.auditTrialServices.audit_trail("2.1","Company","Delete",`${o.companySK.company_id} Company was deleted`,"1"),o.addFromService(),s&&(yield o.fetchTimeMachineById(1,r.P1,"delete",r),yield o.loading(),b().fire("Removed!","Company configuration successfully.","success"))});return function(s){return l.apply(this,arguments)}}()).catch(l=>{console.log("error for deleting",l)})}else a.dismiss===b().DismissReason.cancel&&b().fire("Cancelled","Company configuration not removed","error")}))}}return c=u,(0,m.Z)(u,"\u0275fac",function(t){return new(t||c)(e.Y36(d.QS),e.Y36(U.F),e.Y36(F.t),e.Y36(x.ux),e.Y36(q.H7),e.Y36(w.F0),e.Y36(e.sBO),e.Y36(N.C))}),(0,m.Z)(u,"\u0275cmp",e.Xpm({type:c,selectors:[["app-company"]],viewQuery:function(t,o){if(1&t&&e.Gf(M,5),2&t){let a;e.iGM(a=e.CRH())&&(o.closeCompany=a.first)}},decls:136,vars:21,consts:[[1,"card","mb-5","mb-xl-8"],[1,"card-header","border-0","pt-5"],[1,"card-title","align-items-start","flex-column"],[1,"card-label","fw-bolder","fs-3","mb-1"],[1,"card-toolbar"],["type","button","class","btn btn-sm btn-primary","data-bs-toggle","modal","data-bs-target","#companyModal",3,"click",4,"ngIf"],[1,"card-body","py-3"],[1,"table-responsive"],["id","company_lookup_table",1,"table","table-striped","table-bordered","table-hover","table-responsive-sm"],[4,"ngIf"],["id","companyModal","tabindex","-1","aria-labelledby","companyModalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content",2,"width","1200px","transform","translate(-27%, 0px)"],[1,"modal-header"],["class","modal-title",4,"ngIf"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"fv-row",3,"formGroup"],[1,"card-body","border-top","p-9"],[1,"container"],[1,"row"],[1,"col-lg-4"],[1,"col-lg-12","form-group","image-input","image-input-outline"],["for","imageInput",1,"col-lg-12","col-form-label","fw-bold","fs-6"],["type","file","id","imageInput","title","Click to add/update image",1,"form-control","visually-hidden",3,"change"],["for","imageInput",1,"form-control","form-control-lg","form-control-solid",2,"padding-left","115px"],["class","btn btn-icon btn-box image-input-wrapper w-125px h-125px btn-active-color-primary w-25px h-25px bg-body shadow",3,"src",4,"ngIf"],["for","imageInput1",1,"col-lg-12","col-form-label","fw-bold","fs-6"],["type","file","id","imageInput1","title","Click to add/update image",1,"form-control","visually-hidden",3,"change"],["for","imageInput1",1,"form-control","form-control-lg","form-control-solid",2,"padding-left","115px"],[1,"col-md-4"],[1,"col-lg-12","col-form-label","fw-bold","fs-6","required"],["type","text","placeholder","Enter company ID","name","companyID","formControlName","companyID","required","",1,"form-control","form-control-lg","form-control-solid","mb-3","mb-lg-0",3,"keyup"],[2,"color","#fc1900"],["class","fv-plugins-message-container invalid-feedback",4,"ngIf"],["type","text","placeholder","Enter Client ID","name","clientID","formControlName","clientID","required","",1,"form-control","form-control-lg","form-control-solid","mb-3","mb-lg-0"],["type","text","placeholder","Enter company name","name","companyName","formControlName","companyName","required","",1,"form-control","form-control-lg","form-control-solid","mb-3","mb-lg-0"],["type","text","placeholder","Enter company Description","name","companydesc","formControlName","companydesc","required","",1,"form-control","form-control-lg","form-control-solid","mb-3","mb-lg-0"],["type","text","placeholder","Enter mobile number","name","mobile","formControlName","mobile","minlength","10","maxlength","10","required","",1,"form-control","form-control-lg","form-control-solid","mb-3","mb-lg-0",3,"keyup"],["type","email","placeholder","Enter email","name","email","formControlName","email","required","",1,"form-control","form-control-lg","form-control-solid","mb-3","mb-lg-0",3,"keyup"],[1,"col-lg-12","col-form-label","fw-bold","fs-6"],["type","number","placeholder","Enter Telegram ID","name","telegramID","formControlName","telegramID",1,"form-control","form-control-lg","form-control-solid","mb-3","mb-lg-0"],[1,"form-check","form-check-inline","form-check-solid","me-5"],["name","email_permi","type","checkbox","formControlName","email_permission",1,"form-check-input"],[1,"fw-bold","ps-2","fs-6"],["name","sms","type","checkbox","formControlName","sms_permission",1,"form-check-input"],["name","telegram_permission","type","checkbox","formControlName","telegram_permission",1,"form-check-input"],[1,"col-md-4",2,"padding-top","30px"],["name","health_permission","type","checkbox","formControlName","health_permission",1,"form-check-input"],["name","device_permission","type","checkbox","formControlName","device_permission",1,"form-check-input"],[1,"form-check","form-check-inline","form-check-solid","me-5",2,"padding-top","5px"],["name","alert_permission","type","checkbox","formControlName","alert_permission",1,"form-check-input"],[1,"col-md-4","form-check","form-switch"],[1,"col-lg-12",2,"padding-top","30px"],["formControlName","enableCompany","type","checkbox",1,"col-lg-6","form-check-input"],[1,"col-lg-6","col-form-label","fw-bold","fs-6",2,"padding-top","0px"],["formArrayName","metadata"],[4,"ngFor","ngForOf"],["type","button","ngbTooltip","Add Carefully!!!",1,"btn","btn-sm","btn-icon","btn-primary",2,"font-size","5px",3,"click"],[1,"svg-icon","svg-icon-3",3,"inlineSVG"],[1,"modal-footer"],["type","button","data-bs-dismiss","modal",1,"btn","btn-sm","btn-danger"],["closeCompany",""],["type","submit","class","btn btn-sm btn-primary",3,"hidden","disabled","click",4,"ngIf"],["type","button","class","btn btn-sm btn-primary not-allowed",3,"disabled","click",4,"ngIf"],["type","button","data-bs-toggle","modal","data-bs-target","#companyModal",1,"btn","btn-sm","btn-primary",3,"click"],[1,"modal-title"],[1,"btn","btn-icon","btn-box","image-input-wrapper","w-125px","h-125px","btn-active-color-primary","w-25px","h-25px","bg-body","shadow",3,"src"],[1,"fv-plugins-message-container","invalid-feedback"],[3,"formGroupName"],["type","text","formControlName","key","placeholder","key",2,"margin","2px"],["type","text","formControlName","value","placeholder","value"],["type","button","ngbTooltip","Delete Carefully!!!",1,"btn","btn-sm","btn-icon","btn-danger",2,"font-size","5px",3,"click"],[1,"svg-icon","svg-icon-1",3,"inlineSVG"],["type","submit",1,"btn","btn-sm","btn-primary",3,"hidden","disabled","click"],["type","button",1,"btn","btn-sm","btn-primary","not-allowed",3,"disabled","click"]],template:function(t,o){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h3",2)(3,"span",3),e._uU(4," Company Configuration"),e.qZA()(),e.TgZ(5,"div",4),e.YNc(6,L,2,0,"button",5),e.qZA()()(),e.TgZ(7,"div",0)(8,"div",6)(9,"div",7)(10,"table",8)(11,"thead"),e.YNc(12,J,11,0,"tr",9),e.YNc(13,E,9,0,"tr",9),e.qZA()()()()(),e.TgZ(14,"div",10)(15,"div",11)(16,"div",12)(17,"div",13),e.YNc(18,K,2,0,"h2",14),e.YNc(19,B,2,0,"h2",14),e._UZ(20,"button",15),e.qZA(),e.TgZ(21,"div",16)(22,"div",17)(23,"div",18)(24,"div",19)(25,"div",20)(26,"div",21)(27,"label",22),e._uU(28,"Company Logo 1"),e.qZA(),e.TgZ(29,"input",23),e.NdJ("change",function(i){return o.firstLogoCompany(i)}),e.qZA(),e.TgZ(30,"label",24),e._uU(31,"Upload Image"),e.qZA(),e._UZ(32,"br"),e.YNc(33,O,1,1,"img",25),e.qZA()(),e.TgZ(34,"div",20)(35,"div",21)(36,"label",26),e._uU(37,"Company Logo 2"),e.qZA(),e.TgZ(38,"input",27),e.NdJ("change",function(i){return o.secondLogoCompany(i)}),e.qZA(),e.TgZ(39,"label",28),e._uU(40,"Upload Image"),e.qZA(),e._UZ(41,"br"),e.YNc(42,Q,1,1,"img",25),e.qZA()(),e.TgZ(43,"div",29)(44,"label",30),e._uU(45," Company ID"),e.qZA(),e.TgZ(46,"input",31),e.NdJ("keyup",function(i){return o.checkUniqueIdentifier(i)}),e.qZA(),e.TgZ(47,"span",32),e._uU(48),e.qZA(),e.YNc(49,G,2,0,"div",33),e.qZA()()(),e.TgZ(50,"div",18)(51,"div",19)(52,"div",29)(53,"label",30),e._uU(54," Client ID "),e.qZA(),e._UZ(55,"input",34),e.YNc(56,Y,2,0,"div",33),e.qZA(),e.TgZ(57,"div",29)(58,"label",30),e._uU(59," Company Name"),e.qZA(),e._UZ(60,"input",35),e.YNc(61,z,2,0,"div",33),e.qZA(),e.TgZ(62,"div",29)(63,"label",30),e._uU(64,"Company Description"),e.qZA(),e._UZ(65,"input",36),e.YNc(66,H,2,0,"div",33),e.qZA()()(),e.TgZ(67,"div",18)(68,"div",19)(69,"div",29)(70,"label",30),e._uU(71," Mobile"),e.qZA(),e.TgZ(72,"input",37),e.NdJ("keyup",function(i){return o.keyPress(i)}),e.qZA(),e.TgZ(73,"span",32),e._uU(74),e.qZA(),e.YNc(75,R,2,0,"div",33),e.qZA(),e.TgZ(76,"div",29)(77,"label",30),e._uU(78," Email "),e.qZA(),e.TgZ(79,"input",38),e.NdJ("keyup",function(i){return o.checkMail(i)}),e.qZA(),e.TgZ(80,"span",32),e._uU(81),e.qZA(),e.YNc(82,j,2,0,"div",33),e.qZA(),e.TgZ(83,"div",29)(84,"label",39),e._uU(85," Telegram Channel ID "),e.qZA(),e._UZ(86,"input",40),e.qZA()()(),e.TgZ(87,"div",18)(88,"div",19)(89,"div",29)(90,"label",39),e._uU(91,"Company Permission"),e.qZA(),e.TgZ(92,"label",41),e._UZ(93,"input",42),e.TgZ(94,"span",43),e._uU(95,"Email "),e.qZA()(),e.TgZ(96,"label",41),e._UZ(97,"input",44),e.TgZ(98,"span",43),e._uU(99,"SMS "),e.qZA()(),e.TgZ(100,"label",41),e._UZ(101,"input",45),e.TgZ(102,"span",43),e._uU(103,"Telegram "),e.qZA()()(),e.TgZ(104,"div",46)(105,"label",41),e._UZ(106,"input",47),e.TgZ(107,"span",43),e._uU(108,"Health Check "),e.qZA()(),e.TgZ(109,"label",41),e._UZ(110,"input",48),e.TgZ(111,"span",43),e._uU(112,"Device Timeout "),e.qZA()(),e.TgZ(113,"label",49),e._UZ(114,"input",50),e.TgZ(115,"span",43),e._uU(116,"Alert Timeout "),e.qZA()()(),e.TgZ(117,"div",51)(118,"div",52),e._UZ(119,"input",53),e.TgZ(120,"label",54)(121,"b"),e._uU(122,"Enable Company"),e.qZA()()()()()(),e.TgZ(123,"div",18)(124,"label",39),e._uU(125,"Metadata"),e.qZA(),e.ynx(126,55),e.YNc(127,W,10,2,"ng-container",56),e.BQk(),e.TgZ(128,"button",57),e.NdJ("click",function(){return o.add()}),e._UZ(129,"span",58),e.qZA()(),e.TgZ(130,"div",59)(131,"button",60,61),e._uU(133,"Cancel"),e.qZA(),e.YNc(134,X,2,3,"button",62),e.YNc(135,V,2,1,"button",63),e.qZA()()()()()()),2&t){let a,i,r,l,s,n;e.xp6(6),e.Q6J("ngIf",o.hideDeleteButton),e.xp6(6),e.Q6J("ngIf",!0===o.hideDeleteButton),e.xp6(1),e.Q6J("ngIf",!1===o.hideDeleteButton),e.xp6(5),e.Q6J("ngIf",o.showHeading),e.xp6(1),e.Q6J("ngIf",!o.showHeading),e.xp6(2),e.Q6J("formGroup",o.createCompanyField),e.xp6(12),e.Q6J("ngIf",o.base64textString_temp),e.xp6(9),e.Q6J("ngIf",o.base64textString_temp_logo1),e.xp6(6),e.Oqu(o.errorForUniqueID),e.xp6(1),e.Q6J("ngIf",(null==(a=o.createCompanyField.get("companyID"))?null:a.hasError("required"))&&(null==(a=o.createCompanyField.get("companyID"))?null:a.touched)),e.xp6(7),e.Q6J("ngIf",(null==(i=o.createCompanyField.get("clientID"))?null:i.hasError("required"))&&(null==(i=o.createCompanyField.get("clientID"))?null:i.touched)),e.xp6(5),e.Q6J("ngIf",(null==(r=o.createCompanyField.get("companyName"))?null:r.hasError("required"))&&(null==(r=o.createCompanyField.get("companyName"))?null:r.touched)),e.xp6(5),e.Q6J("ngIf",(null==(l=o.createCompanyField.get("companydesc"))?null:l.hasError("required"))&&(null==(l=o.createCompanyField.get("companydesc"))?null:l.touched)),e.xp6(8),e.Oqu(o.errorForMobile),e.xp6(1),e.Q6J("ngIf",(null==(s=o.createCompanyField.get("mobile"))?null:s.hasError("required"))&&(null==(s=o.createCompanyField.get("mobile"))?null:s.touched)),e.xp6(6),e.Oqu(o.errorForInvalidEmail),e.xp6(1),e.Q6J("ngIf",(null==(n=o.createCompanyField.get("email"))?null:n.hasError("required"))&&(null==(n=o.createCompanyField.get("email"))?null:n.touched)),e.xp6(45),e.Q6J("ngForOf",o.metadata().controls),e.xp6(2),e.Q6J("inlineSVG","./assets/media/icons/duotune/arrows/arr075.svg"),e.xp6(5),e.Q6J("ngIf",o.showModal),e.xp6(1),e.Q6J("ngIf",!o.showModal)}},dependencies:[D.sg,D.O5,d.Fj,d.wV,d.Wl,d.JJ,d.JL,d.Q7,d.wO,d.nD,d.sg,d.u,d.x0,d.CE,A.d$,P._L],styles:[".btn-close[_ngcontent-%COMP%]{background-color:#f1416c}.visually-hidden[_ngcontent-%COMP%]{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}"]})),u})(),te=(()=>{var c;class u{}return c=u,(0,m.Z)(u,"\u0275fac",function(t){return new(t||c)}),(0,m.Z)(u,"\u0275mod",e.oAB({type:c})),(0,m.Z)(u,"\u0275inj",e.cJS({imports:[D.ez,x.ZX,w.Bz.forChild([{path:"",component:ee}])]})),u})()}}]);