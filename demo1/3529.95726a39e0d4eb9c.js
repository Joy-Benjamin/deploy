"use strict";(self.webpackChunkdemo1=self.webpackChunkdemo1||[]).push([[3529],{13529:(ht,K,W)=>{W.r(K),W.d(K,{WritingdevicetypeXlsxModule:()=>ut});var g=W(86656),N=W(96814),Z=W(22939),F=W(64190),R=W(15861),S=W(56223),L=W(11486),O=W(48847),X=W(13519),A=W.n(X),E=W(90775),V=W.n(E),a=W(65879),q=W(31552),B=W(5588),z=W(88672);let J=(()=>{var P;class T{constructor(){(0,g.Z)(this,"columnValidations",{"WDT Id":{required:!0,validate:(i,t)=>this.isString(i)?this.isWhitespace(i)?{isValid:!1,error:"RDT ID cannot contains space"}:{isValid:!0}:{isValid:!1,error:"RDT ID must be text"}},"WDT Label":{required:!0,validate:(i,t)=>this.isString(i)?" "==i.charAt(0)?{isValid:!1,error:"RDT Label cannot have spaces at start"}:{isValid:!0}:{isValid:!1,error:"RDT label must be text"}}})}getColumnLetter(i){let t="";for(;i>=0;)t=String.fromCharCode(i%26+65)+t,i=Math.floor(i/26)-1;return t}isString(i){return"string"==typeof i||i instanceof String}isNumber(i){return!isNaN(Number(i))&&"boolean"!=typeof i}isInteger(i){return Number.isInteger(Number(i))}isPositive(i){return i>0}isWhitespace(i){return/\s/.test(i)}validateExcelFile(i,t,r,o,u,h){var p=this;return(0,R.Z)(function*(){return new Promise((n,e)=>{const d=[],c=[],v=[];try{const y=i[0],f=i.slice(1).map(l=>l[0]),I=i.slice(1).map(l=>l[1]);Object.entries(p.columnValidations).forEach(([l,s])=>{if(s.required&&!y.includes(l)){const _=Object.keys(p.columnValidations).indexOf(l);d.push({row:1,column:l,columnLetter:p.getColumnLetter(_),value:"Missing",error:`Required column "${l}" is missing`})}});for(let l=1;l<i.length;l++){const s=i[l];if(0===s.length)break;y.forEach((_,k)=>{const w=p.columnValidations[_];if(w){const C=s[k],b=p.getColumnLetter(k);if(w.required&&(null==C||""===C)&&d.push({row:l+1,column:_,columnLetter:b,value:C,error:`${_} is required`}),"WDT Id"===_&&w.required&&C&&t.includes(C.trim())&&!o&&d.push({row:l+1,column:_,columnLetter:b,value:C,error:"WDT ID already present"}),"WDT Label"===_&&w.required&&C&&r.includes(C.trim())){const x=h&&s[1]&&h.find(m=>m.P2==s[1].trim());(!o||x&&x&&x.P1&&x.P1!=s[0].trim())&&d.push({row:l+1,column:_,columnLetter:b,value:C,error:"WDT Label already present"})}if("WDT Id"===_&&w.required&&C&&0==t.includes(C.trim())&&o&&d.push({row:l+1,column:_,columnLetter:b,value:C,error:"WDT Id does not exist"}),"WDT Id"===_&&w.required&&null!=C&&null!=C&&""!=C&&C&&f.filter(m=>m==C.trim()).length>1&&d.push({row:l+1,column:_,columnLetter:b,value:C,error:"Duplicate WDT Id found with name"}),"WDT Label"===_&&w.required&&null!=C&&null!=C&&""!=C&&C&&I.filter(m=>m==C.trim()).length>1&&d.push({row:l+1,column:_,columnLetter:b,value:C,error:"Duplicate WDT Label found with name"}),null!=C&&""!==C){const x=w.validate(C,l+1);x.isValid||d.push({row:l+1,column:_,columnLetter:b,value:C,error:x.error})}}}),o?v.push(s):c.push(s)}console.log("Errors array is here ",d),n({isValid:0===d.length,errors:d,createRows:c,updateRows:v})}catch(y){e(`Error processing data: ${y.message}`)}})})()}formatValidationErrors(i){return i.map(t=>`Row ${t.row}, Column ${t.columnLetter} (${t.column}): ${t.error}${t.value?` (${t.value})`:""}`)}}return P=T,(0,g.Z)(T,"\u0275fac",function(i){return new(i||P)}),(0,g.Z)(T,"\u0275prov",a.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"})),T})(),U=(()=>{var P;class T{getColumnLetter(i){let t="";for(;i>=0;)t=String.fromCharCode(i%26+65)+t,i=Math.floor(i/26)-1;return t}isString(i){return"string"==typeof i||i instanceof String}isNumber(i){return!isNaN(Number(i))&&"boolean"!=typeof i}isInteger(i){return Number.isInteger(Number(i))}isPositive(i){return i>0}isWhitespace(i){return/\s/.test(i)}constructor(){(0,g.Z)(this,"columnValidations",{"WDT Id":{required:!0,validate:(i,t)=>this.isString(i)?this.isWhitespace(i)?{isValid:!1,error:"WDT ID cannot contains space"}:{isValid:!0}:{isValid:!1,error:"WDT ID must be text"}},"Parameter ID":{required:!0,validate:(i,t)=>this.isString(i)?this.isWhitespace(i)?{isValid:!1,error:"Parameter ID cannot contains space"}:{isValid:!0}:{isValid:!1,error:"Parameter ID must be text"}},"Parameter Label":{required:!0,validate:(i,t)=>this.isString(i)?" "==i.charAt(0)?{isValid:!1,error:"Parameter Label cannot have spaces at start"}:{isValid:!0}:{isValid:!1,error:"Parameter Label must be text"}},"Parameter Description":{required:!1,validate:(i,t)=>({isValid:!0})},"Start Address":{required:!0,validate:(i,t)=>({isValid:!0})},"Variable Type":{required:!0,validate:(i,t)=>this.isString(i)?" "==i.charAt(0)?{isValid:!1,error:"Variable Type cannot have spaces at start"}:{isValid:!0}:{isValid:!1,error:"Variable Type must be text"}},"Min Value":{required:!0,validate:(i,t)=>this.isNumber(i)?{isValid:!0}:{isValid:!1,error:"Min Value must be a number"}},"Max Value":{required:!0,validate:(i,t)=>this.isNumber(i)?{isValid:!0}:{isValid:!1,error:"Max Value must be a number"}},"mX+C X Multiplication Factor":{required:!0,validate:(i,t)=>this.isNumber(i)?{isValid:!0}:{isValid:!1,error:"mX+C X Multiplication Factor must be a number"}},"mX+C C Addition Factor":{required:!0,validate:(i,t)=>this.isNumber(i)?{isValid:!0}:{isValid:!1,error:"mX+C C Addition Factor must be a number"}},"Control Type":{required:!0,validate:(i,t)=>this.isString(i)?{isValid:!0}:{isValid:!1,error:"Control Type must be text"}},Step:{required:!0,validate:(i,t)=>({isValid:!0})},"Block Number":{required:!0,validate:(i,t)=>this.isNumber(i)?{isValid:!0}:{isValid:!1,error:"Block Number must be a number"}},"RDT ID":{required:!1,validate:(i,t)=>this.isString(i)?{isValid:!0}:{isValid:!1,error:"RDT ID must be text"}},"No of Binding Reading Parameter":{required:!1,validate:(i,t)=>this.isNumber(i)?{isValid:!0}:{isValid:!1,error:"No of Binding Reading Parameter must be a number"}},"Add Binding Reading Parameter":{required:!1,validate:(i,t)=>this.isString(i)?{isValid:!0}:{isValid:!1,error:"Add Binding Reading Parameter must be text"}},"Enable Binding Reading Parameter":{required:!1,validate:(i,t)=>null!=i&&""!==i&&"boolean"!=typeof i&&"true"!==i&&"false"!==i?{isValid:!1,error:"Enable Binding Reading Parameter must be boolean such as true/false"}:{isValid:!0}},"No of Dropdown":{required:!1,validate:(i,t)=>this.isNumber(i)?{isValid:!0}:{isValid:!1,error:"No of Dropdow must be a number"}},Label:{required:!1,validate:(i,t)=>this.isString(i)?{isValid:!0}:{isValid:!1,error:"Label must be text"}},Value:{required:!1,validate:(i,t)=>this.isString(i)?{isValid:!0}:{isValid:!1,error:"Value must be text"}}})}validateExcelFile(i,t,r,o,u,h,p){var n=this;return(0,R.Z)(function*(){return new Promise((e,d)=>{const c=[],v=[],y=[];try{const f=i[0],I=i.slice(1).map(s=>({paramID:s[1],device:s[0]})),l=i.slice(1).map(s=>s[2]);Object.entries(n.columnValidations).forEach(([s,_])=>{if(_.required&&!f.includes(s)){const k=Object.keys(n.columnValidations).indexOf(s);c.push({row:1,column:s,columnLetter:n.getColumnLetter(k),value:"Missing",error:`Required column "${s}" is missing`})}});for(let s=1;s<i.length;s++){const _=i[s];if(0===_.length)break;f.forEach((k,w)=>{const C=n.columnValidations[k];if(console.log("Validations are here ",C),C){const b=_[w];let x=n.getColumnLetter(w);if(C.required&&(null==b||""===b)&&c.push({row:s+1,column:k,columnLetter:x,value:b,error:`${k} is required`}),"WDT Id"===k&&C.required&&b&&0==t.includes(b.trim())&&c.push({row:s+1,column:k,columnLetter:x,value:b,error:"WDT ID does not exist"}),"Parameter ID"===k&&C.required&&null!=b&&null!=b&&""!=b&&b&&I.filter(M=>M.paramID==b.trim()&&M.device==_[0]).length>1&&c.push({row:s+1,column:k,columnLetter:x,value:b,error:"Duplicate WDT Parameter Id found with name"}),"Parameter Label"===k&&C.required&&null!=b&&null!=b&&""!=b&&b&&l.filter(M=>M==b.trim()).length>1&&c.push({row:s+1,column:k,columnLetter:x,value:b,error:"Duplicate Parameter Label found with name"}),"RDT ID"===k&&b&&0==p.includes(b.trim())&&c.push({row:s+1,column:k,columnLetter:x,value:b,error:"RDT ID does not exist"}),"No of Binding Reading Parameter"===k&&b&&b>0){x=n.getColumnLetter(13),(null==_[13]||""===_[13])&&c.push({row:s+1,column:k,columnLetter:x,value:b,error:"RDT ID is required"});const m=_[15];x=n.getColumnLetter(15),console.log("noOfBindingParameters ",m),(null==m||""===m)&&c.push({row:s+1,column:f[15],columnLetter:x,value:m,error:`${f[15]} is required`}),null!=m&&null!=m&&""!=m&&1==b?m.toString().includes(",")&&c.push({row:s+1,column:f[15],columnLetter:x,value:m,error:`${f[15]} If the No of Binding Reading Parameter is 1, there is no need to add comma-separated`}):null!=m&&null!=m&&""!=m&&(0==m.includes(",")||m.split(",").length!=b)&&c.push({row:s+1,column:f[15],columnLetter:x,value:m,error:`${f[15]} mismatched with No of Binding Reading Parameter (It should be comma separated)`})}if("No of Dropdown"===k&&b&&b>0){console.log("Cell value for dropdown is here ",b),b&&b>0&&(x=n.getColumnLetter(23),(null==_[23]||""===_[23])&&c.push({row:s+1,column:k,columnLetter:x,value:b,error:"Label is required"}));const m=_[23];x=n.getColumnLetter(23),(null==m||""===m)&&c.push({row:s+1,column:f[23],columnLetter:x,value:m,error:`${f[23]} is required`}),null!=m&&null!=m&&""!=m&&1==b?m.toString().includes(",")&&c.push({row:s+1,column:f[23],columnLetter:x,value:m,error:`${f[23]} If the No of Dropdown is 1, there is no need to add comma-separated`}):null!=m&&null!=m&&""!=m&&(0==m.includes(",")||m.split(",").length!=b)&&c.push({row:s+1,column:f[23],columnLetter:x,value:m,error:`${f[23]} mismatched with Label (It should be comma separated)`}),x=n.getColumnLetter(24),(null==m||""===m)&&c.push({row:s+1,column:f[24],columnLetter:x,value:m,error:`${f[24]} is required`}),null!=m&&null!=m&&""!=m&&1==b?m.toString().includes(",")&&c.push({row:s+1,column:f[24],columnLetter:x,value:m,error:`${f[24]} If the No of Dropdown is 1, there is no need to add comma-separated`}):null!=m&&null!=m&&""!=m&&(0==m.includes(",")||m.split(",").length!=b)&&c.push({row:s+1,column:f[24],columnLetter:x,value:m,error:`${f[24]} mismatched with Label (It should be comma separated)`})}if(null!=b&&""!==b){const m=C.validate(b,s+1);m.isValid||c.push({row:s+1,column:k,columnLetter:x,value:b,error:m.error})}}}),o?y.push(_):v.push(_)}console.log("Errors array is here ",c),e({isValid:0===c.length,errors:c,createRows:v,updateRows:y})}catch(f){d(`Error processing data: ${f.message}`)}})})()}formatValidationErrors(i){return i.map(t=>`Row ${t.row}, Column ${t.columnLetter} (${t.column}): ${t.error}${t.value?` (${t.value})`:""}`)}}return P=T,(0,g.Z)(T,"\u0275fac",function(i){return new(i||P)}),(0,g.Z)(T,"\u0275prov",a.Yz7({token:P,factory:P.\u0275fac,providedIn:"root"})),T})();var $=W(14934);const j=["fileUpload"],G=["container"];function H(P,T){1&P&&(a.TgZ(0,"small",7),a._uU(1," Type is required. "),a.qZA())}function Y(P,T){if(1&P){const D=a.EpF();a.TgZ(0,"div",5)(1,"label",6),a._uU(2,"Upload Excel File"),a.qZA(),a.TgZ(3,"input",26),a.NdJ("change",function(t){a.CHM(D);const r=a.oxw();let o;return a.KtG(r.onFileChange(t,null==(o=r.createWDTXlsx.get("type"))?null:o.value))}),a.qZA()()}}function Q(P,T){if(1&P){const D=a.EpF();a.TgZ(0,"button",27),a.NdJ("click",function(){a.CHM(D);const t=a.oxw();let r;return a.KtG(t.onFileSelected(null==(r=t.createWDTXlsx.get("type"))?null:r.value,"update"))}),a._uU(1," \u270f\ufe0f Update "),a.qZA()}if(2&P){const D=a.oxw();let i;a.Q6J("disabled",!(null!=(i=D.createWDTXlsx.get("type"))&&i.value))}}function tt(P,T){if(1&P){const D=a.EpF();a.TgZ(0,"button",28),a.NdJ("click",function(){a.CHM(D);const t=a.oxw();let r;return a.KtG(t.fetchLoggedInClientWDT(null==(r=t.createWDTXlsx.get("type"))?null:r.value))}),a._uU(1," \u{1f4e5} Get Data "),a.qZA()}if(2&P){const D=a.oxw();let i;a.Q6J("disabled",!(null!=(i=D.createWDTXlsx.get("type"))&&i.value))}}function et(P,T){if(1&P){const D=a.EpF();a.TgZ(0,"button",29),a.NdJ("click",function(){a.CHM(D);const t=a.oxw();let r;return a.KtG(t.onFileSelected(null==(r=t.createWDTXlsx.get("type"))?null:r.value,"add"))}),a._uU(1," \u2795 Add New "),a.qZA()}if(2&P){const D=a.oxw();let i;a.Q6J("disabled",!(null!=(i=D.createWDTXlsx.get("type"))&&i.value))}}function it(P,T){if(1&P){const D=a.EpF();a.TgZ(0,"button",30),a.NdJ("click",function(){a.CHM(D);const t=a.oxw();let r;return a.KtG(t.downloadV2(null==(r=t.createWDTXlsx.get("type"))?null:r.value))}),a._UZ(1,"i",31),a._uU(2," Download "),a.qZA()}if(2&P){const D=a.oxw();let i;a.Q6J("disabled",!(null!=(i=D.createWDTXlsx.get("type"))&&i.value))}}function at(P,T){if(1&P){const D=a.EpF();a.TgZ(0,"div",32)(1,"button",33),a.NdJ("click",function(){a.CHM(D);const t=a.oxw();return a.KtG(t.prevPage())}),a._uU(2,"Previous"),a.qZA(),a.TgZ(3,"span"),a._uU(4),a.qZA(),a.TgZ(5,"button",33),a.NdJ("click",function(){a.CHM(D);const t=a.oxw();return a.KtG(t.nextPage())}),a._uU(6,"Next"),a.qZA()()}if(2&P){const D=a.oxw();a.xp6(1),a.Q6J("disabled",0===D.currentPage),a.xp6(3),a.AsE("Page ",D.currentPage+1," of ",D.totalPages,""),a.xp6(1),a.Q6J("disabled",D.currentPage>=D.totalPages-1)}}function rt(P,T){if(1&P&&(a.TgZ(0,"div",42),a._uU(1),a.qZA()),2&P){const D=a.oxw(2);a.xp6(1),a.Oqu(D.error)}}function ot(P,T){if(1&P&&(a.TgZ(0,"tr")(1,"td",50),a._uU(2),a.qZA(),a.TgZ(3,"td"),a._uU(4),a.qZA(),a.TgZ(5,"td"),a._uU(6),a.qZA()()),2&P){const D=T.$implicit;a.xp6(2),a.Oqu(D.split(",")[0].replace("Row ","")),a.xp6(2),a.Oqu(D.split(":")[0].split(",")[1].trim()),a.xp6(2),a.Oqu(D.split(":")[1].trim())}}function nt(P,T){if(1&P&&(a.TgZ(0,"div",43)(1,"div",42)(2,"div",44)(3,"strong"),a._uU(4,"Errors Found:"),a.qZA(),a.TgZ(5,"span",45),a._uU(6),a.qZA()(),a.TgZ(7,"div",46)(8,"table",47)(9,"thead",48)(10,"tr")(11,"th"),a._uU(12,"Row"),a.qZA(),a.TgZ(13,"th"),a._uU(14,"Column"),a.qZA(),a.TgZ(15,"th"),a._uU(16,"Error"),a.qZA()()(),a.TgZ(17,"tbody"),a.YNc(18,ot,7,3,"tr",49),a.qZA()()()()()),2&P){const D=a.oxw(2);a.xp6(6),a.hij("",D.validationErrors.length," issues"),a.xp6(12),a.Q6J("ngForOf",D.validationErrors)}}function st(P,T){if(1&P){const D=a.EpF();a.TgZ(0,"div",34)(1,"h5",35),a._uU(2,"Validation Issues"),a.qZA(),a.TgZ(3,"button",36),a.NdJ("click",function(){const r=a.CHM(D).$implicit;return a.KtG(r.dismiss())}),a.qZA()(),a.TgZ(4,"div",37),a.YNc(5,rt,2,1,"div",38),a.YNc(6,nt,19,2,"div",39),a.qZA(),a.TgZ(7,"div",40)(8,"button",41),a.NdJ("click",function(){const r=a.CHM(D).$implicit;return a.KtG(r.dismiss())}),a._uU(9,"Close"),a.qZA()()}if(2&P){const D=a.oxw();a.xp6(5),a.Q6J("ngIf",D.error),a.xp6(1),a.Q6J("ngIf",D.validationErrors.length>0)}}const lt=function(){return["wdt_xlsx","parameter_xlsx"]};let dt=(()=>{var P;class T{constructor(i,t,r,o,u,h,p,n,e,d){(0,g.Z)(this,"fb",void 0),(0,g.Z)(this,"toast",void 0),(0,g.Z)(this,"api",void 0),(0,g.Z)(this,"getWritingDeviceType",void 0),(0,g.Z)(this,"router",void 0),(0,g.Z)(this,"spinner",void 0),(0,g.Z)(this,"excelValidator",void 0),(0,g.Z)(this,"cd",void 0),(0,g.Z)(this,"excelParameterValidator",void 0),(0,g.Z)(this,"modalService",void 0),(0,g.Z)(this,"fileUpload",void 0),(0,g.Z)(this,"createWDTXlsx",void 0),(0,g.Z)(this,"previewData",[[],[]]),(0,g.Z)(this,"WDT_Id",void 0),(0,g.Z)(this,"grid",void 0),(0,g.Z)(this,"userClientIDCognito",void 0),(0,g.Z)(this,"multiWDT",[]),(0,g.Z)(this,"specific_WDT",void 0),(0,g.Z)(this,"ADD_finalData",{}),(0,g.Z)(this,"SK_clientID",""),(0,g.Z)(this,"uniqueWDTList",[]),(0,g.Z)(this,"RDT_params_id_label_List",[]),(0,g.Z)(this,"allParams_list",[]),(0,g.Z)(this,"data_temp",[]),(0,g.Z)(this,"tempMultiData",[]),(0,g.Z)(this,"renameKeys",[]),(0,g.Z)(this,"parameterAllDetails",{}),(0,g.Z)(this,"tempMultiParams",[]),(0,g.Z)(this,"enable_binding_parameter",""),(0,g.Z)(this,"allPermissions_user",void 0),(0,g.Z)(this,"hideUpdateButton",!1),(0,g.Z)(this,"hideGetButton",!1),(0,g.Z)(this,"container",void 0),(0,g.Z)(this,"maxlength",500),(0,g.Z)(this,"clientID",void 0),(0,g.Z)(this,"lookup_data_user",[]),(0,g.Z)(this,"lookup_data_temp1",[]),(0,g.Z)(this,"fileName",""),(0,g.Z)(this,"savedFileEvent",void 0),(0,g.Z)(this,"error",void 0),(0,g.Z)(this,"validationErrors",[]),(0,g.Z)(this,"selectedFile",void 0),(0,g.Z)(this,"validExcelData",void 0),(0,g.Z)(this,"uniqueWDTLabels",[]),(0,g.Z)(this,"allRDTDetails",void 0),(0,g.Z)(this,"uniqueRDTList",[]),(0,g.Z)(this,"pagedPreviewData",[]),(0,g.Z)(this,"pageSize",50),(0,g.Z)(this,"currentPage",0),(0,g.Z)(this,"totalPages",void 0),this.fb=i,this.toast=t,this.api=r,this.getWritingDeviceType=o,this.router=u,this.spinner=h,this.excelValidator=p,this.cd=n,this.excelParameterValidator=e,this.modalService=d}ngOnInit(){this.initializeWDTxlsxFields(),this.userClientIDCognito=JSON.parse(JSON.parse(JSON.stringify(localStorage.getItem("userAttributes")))),this.SK_clientID=this.userClientIDCognito.attributes["custom:clientID"],this.clientID=this.SK_clientID+"#wdt",this.allPermissions_user=JSON.parse(JSON.parse(JSON.stringify(localStorage.getItem("permissionDetails")))),this.fetchTMLookupData(1),this.fetchRDTList(1),this.checkPermission()}checkPermission(){let i=!1,t=!1;for(let r=0;r<this.allPermissions_user.length;r++)"Writing Device Type - xlsx Update"===this.allPermissions_user[r]?(i=!0,this.hideGetButton=!0,this.hideUpdateButton=!0):"Writing Device Type - xlsx View"===this.allPermissions_user[r]&&(t=!0,this.hideGetButton=!0,this.hideUpdateButton=!1);i&&t||i||t?this.hideGetButton=!0:this.router.navigate(["/404"])}initializeWDTxlsxFields(){this.createWDTXlsx=this.fb.group({type:["",S.kI.required]})}fetchTMLookupData(i){var t=this;return(0,R.Z)(function*(){console.log("Iam called Bro");try{const r=yield t.api.GetLookupMasterTable(t.clientID,i);if(r&&r.items)if("string"==typeof r.items){let o=JSON.parse(r.items);if(console.log("d1 =",o),Array.isArray(o)){for(let u=0;u<o.length;u++){const h=o[u];if(null==h)break;{const p=Object.keys(h)[0],{P1:n,P2:e,P3:d,P4:c}=h[p];t.lookup_data_user.push({P1:n,P2:e,P3:d,P4:c}),console.log("d2 =",t.lookup_data_user)}}t.lookup_data_user.sort((u,h)=>h.P4-u.P4),console.log("Lookup sorting",t.lookup_data_user),yield t.fetchTMLookupData(i+1)}else console.error("Invalid data format - not an array.")}else console.error("response.listOfItems is not a string.");else console.log(),console.log("Permissions to be displayed",t.lookup_data_user),t.uniqueWDTList=t.lookup_data_user.map(o=>o.P1),t.uniqueWDTLabels=t.lookup_data_user.map(o=>o.P2)}catch(r){console.error("Error:",r)}})()}fetchRDTList(i){var t=this;return(0,R.Z)(function*(){console.log("iam trying to fetch",t.SK_clientID);try{const r=yield t.api.GetLookupMasterTable(`${t.SK_clientID}#rdt`,i);if(r&&r.items)if("string"==typeof r.items){let o=JSON.parse(r.items);if(console.log("d1 =",o),Array.isArray(o)){for(let u=0;u<o.length;u++){const h=o[u];if(null==h)break;{const p=Object.keys(h)[0],{P1:n,P2:e,P3:d,P4:c}=h[p];t.lookup_data_temp1.push({P1:n,P2:e,P3:d,P4:c}),console.log("d2 =",t.lookup_data_temp1)}}t.lookup_data_temp1.sort((u,h)=>h.P4-u.P4),console.log("Lookup sorting",t.lookup_data_temp1),yield t.fetchRDTList(i+1)}else console.error("Invalid data format - not an array.")}else console.error("response.listOfItems is not a string.");else{console.log();for(let o=0;o<t.lookup_data_temp1.length;o++)t.uniqueRDTList.push(t.lookup_data_temp1[o]?.P1);console.log("All the RDT are here :",t.uniqueRDTList)}}catch(r){console.error("Error:",r)}})()}downloadV2(i){var t=this;return(0,R.Z)(function*(){if(""===i)return t.toast.open("Select type","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});let r=[],o="",u={};"wdt_xlsx"===i&&(r=[["WDT Id","WDT Label","Reserved 1","Reserved 2","Reserved 3","Reserved 4","Reserved 5"],["","","","","","",""]],o="Writing Device Type.xlsx"),"parameter_xlsx"===i&&(r=[["WDT Id","Parameter ID","Parameter Label","Parameter Description","Start Address","Variable Type","Min Value","Max Value","mX+C X Multiplication Factor","mX+C C Addition Factor","Control Type","Step","Block Number","RDT ID","No of Binding Reading Parameter","Add Binding Reading Parameter","Enable Binding Reading Parameter","Reserved 1","Reserved 2","Reserved 3","Reserved 4","Reserved 5","No of Dropdown","Label","Value"],["","","","","","","","","","","","","","","","","","","","","","","","",""]],o="Writing Parameters.xlsx",u={"Variable Type":["Bit Coil","Signed and Unsigned","Signed and Unsigned-multiple","float","Long","Long Inverse"],"Control Type":["Slider","ON & OFF button","Inverted ON & OFF button","Dropdown-Selection"]});const h=["WDT Id","WDT Label","Parameter ID","Parameter Label","Parameter Description","Start Address","Variable Type","Min Value","Max Value","mX+C X Multiplication Factor","mX+C C Addition Factor","Control Type","Step","Block Number"],p=new(V().Workbook),n=p.addWorksheet("Sheet1");n.addRow(r[0]),r[0].forEach((d,c)=>{if(n.getCell(1,c+1).style=h.includes(d)?{fill:{type:"pattern",pattern:"solid",fgColor:{argb:"FF0000"}},font:{bold:!0,color:{argb:"FFFFFF"}}}:{fill:{type:"pattern",pattern:"solid",fgColor:{argb:"FFA500"}},font:{bold:!0,color:{argb:"FFFFFF"}}},u[d]){const y=n.getColumn(c+1).letter;n.dataValidations.add(`${y}2:${y}1000`,{type:"list",allowBlank:!0,formulae:[`"${u[d].join(",")}"`]})}}),(t.grid.data&&JSON.parse(JSON.stringify(t.grid.data))).splice(1).forEach(d=>{n.addRow(d)}),n.columns=r[0].map(()=>({width:20})),p.xlsx.writeBuffer().then(d=>{const c=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),v=document.createElement("a");v.href=URL.createObjectURL(c),v.download=o,v.click()})})()}exportTemplate(i){""==i&&this.toast.open("Select type","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});let t,r,o={};"wdt_xlsx"==i&&(t=[["WDT Id","WDT Label","Reserved 1","Reserved 2","Reserved 3","Reserved 4","Reserved 5"],["","","","","","",""]],r="Writing Device Type.xlsx"),"parameter_xlsx"==i&&(t=[["WDT Id","Parameter ID","Parameter Label","Parameter Description","Start Address","Variable Type","Min Value","Max Value","mX+C X Multiplication Factor","mX+C C Addition Factor","Control Type","Step","Block Number","RDT ID","No of Binding Reading Parameter","Add Binding Reading Parameter","Enable Binding Reading Parameter","Reserved 1","Reserved 2","Reserved 3","Reserved 4","Reserved 5","No of Dropdown","Label","Value"],["","","","","","","","","","","","","","","","","","","","","","",""]],r="Writing Parameters.xlsx",o={"Variable Type":["Bit Coil","Signed and Unsigned","Signed and Unsigned-multiple","float","Long","Long Inverse"],"Control Type":["Slider","ON & OFF button","Inverted ON & OFF button","Dropdown-Selection"]});const u=new(V().Workbook),h=u.addWorksheet("WDT");h.addRows(t),h.columns=t[0].map(()=>({width:50}));const p=["WDT Id","WDT Label","Parameter ID","Parameter Label","Parameter Description","Start Address","Variable Type","Min Value","Max Value","mX+C X Multiplication Factor","mX+C C Addition Factor","Control Type","Step","Block Number"];t[0].forEach((n,e)=>{if(h.getCell(1,e+1).style={fill:{type:"pattern",pattern:"solid",fgColor:{argb:p.includes(n)?"FF0000":"FFA500"}},font:{bold:!0,color:{argb:"FFFFFF"}}},o[n]){const c=h.getColumn(e+1).letter;h.dataValidations.add(`${c}2:${c}1000`,{type:"list",allowBlank:!0,formulae:[`"${o[n].join(",")}"`]})}}),u.xlsx.writeBuffer().then(n=>{const e=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),d=document.createElement("a");d.href=URL.createObjectURL(e),d.download=r,d.click()}).catch(n=>{console.error("Error writing the file",n)})}onFileSelected(i,t){this.handleFile(this.savedFileEvent,t,i)}handleFile(i,t,r){var o=this;return(0,R.Z)(function*(){let u=!1,h=!1;if("add"!==t?(u=!0,"parameter_xlsx"!=r?h=!0:yield A().fire({position:"center",title:"Parameters will be added/updated",html:'<div style="text-align: justify;">Non-existing Parameter will result in the creation of a new Parameter, and any existing Parameter will be updated.</div>',icon:"warning",allowOutsideClick:!1,showCancelButton:!0,confirmButtonText:"Continue"}).then(p=>{p.dismiss!==A().DismissReason.cancel&&(h=!0)})):"parameter_xlsx"!=r?h=!0:yield A().fire({position:"center",title:"Parameters will be replaced",html:'<div style="text-align: justify;">All the Excel Parameters will be replacing the existing parameters.</div>',icon:"warning",allowOutsideClick:!1,showCancelButton:!0,confirmButtonText:"Continue"}).then(p=>{p.dismiss!==A().DismissReason.cancel&&(h=!0)}),console.log("Confirm flag is here ",h),h){if(console.log("Target file is here ",i),console.log("data Grid is here ",o.grid.data),o.error="",o.validationErrors=[],!i.name.toLowerCase().endsWith(".xlsx"))return void(o.error="Please select an XLSX file");if(i.size>5242880)return void(o.error="File size must be less than 5MB");o.selectedFile=i;try{let p={};if(p="parameter_xlsx"==r?yield o.excelParameterValidator.validateExcelFile(o.previewData,o.uniqueWDTList,o.uniqueWDTLabels,u,o.SK_clientID,[],o.uniqueRDTList):yield o.excelValidator.validateExcelFile(o.previewData,o.uniqueWDTList,o.uniqueWDTLabels,u,o.SK_clientID,o.lookup_data_user),p.isValid){if(o.validExcelData=p,!o.selectedFile||o.validationErrors.length>0)return;try{const n=o.validExcelData.createRows,e=o.validExcelData.updateRows;if(o.spinner.show(),n&&Array.isArray(n)&&n.length>0&&!u&&"parameter_xlsx"!=r)for(let d of n)yield o.createNewWDT(d);if(e&&Array.isArray(e)&&e.length>0&&u&&"parameter_xlsx"!=r){console.log("Update operation is called ");for(let d of e)yield o.updateWDT(d)}n&&Array.isArray(n)&&n.length>0&&!u&&"parameter_xlsx"==r&&(yield o.createParameterWDT(n,"add")),e&&Array.isArray(e)&&e.length>0&&u&&"parameter_xlsx"==r&&(yield o.createParameterWDT(e,"update")),console.log("Data to be added/update is here ",n),u||"parameter_xlsx"==r?u&&"parameter_xlsx"!=r?A().fire({icon:"success",title:`${e.length} ${e.length>1?"WDTs updated Successfully":"WDT updated Successfully"}`,showConfirmButton:!0}):u&&"parameter_xlsx"==r?A().fire({icon:"success",title:`${e.length} ${e.length>1?"Writing Parameters updated Successfully":"Writing Parameter updated Successfully"}`,showConfirmButton:!0}):A().fire({icon:"success",title:`${n.length} ${n.length>1?"Writing Parameters added Successfully":"Writing Parameter added Successfully"}`,showConfirmButton:!0}):A().fire({icon:"success",title:`${n.length} ${n.length>1?"WDTs added Successfully":"WDT added Successfully"}`,showConfirmButton:!0})}catch(n){o.error="Error uploading file. Please try again."}finally{o.spinner.hide()}}else o.validationErrors="parameter_xlsx"==r?o.excelParameterValidator.formatValidationErrors(p.errors):o.excelValidator.formatValidationErrors(p.errors),o.openFileUploadModal(o.fileUpload)}catch(p){console.log("Error message is here ",p),o.error=p.message||"Error validating file",o.selectedFile=null}}})()}createParameterWDT(i,t){var r=this;return(0,R.Z)(function*(){try{console.log("User Details are here ",i);const o=i.reduce((n,e)=>{const d=e[0]?.trim();return n[d]||(n[d]=[]),n[d].push(e),n},{});console.log("Grouped data is here ",o);const u=n=>"string"==typeof n?n.split(","):[n];for(const n of Object.keys(o)){const e=[];for(const d of o[n]){let c=[];if(d&&d[22]>0){const v=u(d[23]),y=u(d[24]);for(let f=0;f<d[22];f++)c.push({dropdown_label:"string"==typeof v[f]?v[f].trim():v[f],dropdown_value:"string"==typeof y[f]?y[f].trim():y[f]})}e.push({parameterID:d[1],parameterLabel:d[2],parameterDescription:d[3],communication_type:"Automatic",start_address:d[4]&&"string"==typeof d[4]?d[4]:d[4].toString(),variable_type:d[5],min:d[6],max:d[7],mX_C_X_Multiplication_Factor:d[8],mX_C_C_Addition_Factor:d[9],control_type:d[10],step:d[11]&&"string"==typeof d[11]?d[11]:d[11].toString(),blockNumber:d[12],rdt:d[13],binding_parameter:1==d[16]||"true"==d[16]?u(d[15]):[],enable_binding_parameter:d[16],dropdownLabel_value:JSON.stringify(c)})}o[n]=e}if(console.log("Grouped data after parameters is being added ",o),"update"===t)for(const n of Object.keys(o))try{const e=yield r.api.GetWritingDeviceType(n,r.SK_clientID);if(e&&e.parameters){const d=JSON.parse(e.parameters);if(d&&Array.isArray(d)){for(const _ of o[n]){const k=d.findIndex(w=>w.parameterID===_.parameterID);-1!==k?d[k]=_:d.push(_)}console.log("DB parameters are here to be updated ",d);let c="";r.allRDTDetails={PK:n,SK:r.SK_clientID,parameters:JSON.stringify(d),wdt_parameter_id:n,updated:new Date};let y="";y=1===d.length?d[0].parameterID:d.length>1?d[0].parameterID+"...("+d.length+")":"...(0)",c=r.lookup_data_user.find(_=>_.P1===r.allRDTDetails.PK)?.P2||"";const I=Math.ceil((new Date).getTime()/1e3),l={P1:r.allRDTDetails.PK,P2:c,P3:y,P4:I};console.log("RDT details are here ",r.allRDTDetails),console.log("Lookup items are here ",l),(yield r.api.UpdateWritingDeviceType(r.allRDTDetails))&&(yield r.fetchTimeMachineById(1,l.P1,"update",l))}}}catch(e){console.log("Error getting Reading device Type ",e)}else for(const n of Object.keys(o)){let e="";r.allRDTDetails={PK:n,SK:r.SK_clientID,parameters:JSON.stringify(o[n]),wdt_parameter_id:n,updated:new Date};const d=o[n];let c="";c=1===d.length?d[0].parameterID:d.length>1?d[0].parameterID+"...("+d.length+")":"...(0)",e=r.lookup_data_user.find(l=>l.P1===r.allRDTDetails.PK)?.P2||"";const y=Math.ceil((new Date).getTime()/1e3),f={P1:r.allRDTDetails.PK,P2:e,P3:c,P4:y};console.log("RDT details are here ",r.allRDTDetails),console.log("Lookup items are here ",f),(yield r.api.UpdateWritingDeviceType(r.allRDTDetails))&&(yield r.fetchTimeMachineById(1,f.P1,"update",f))}}catch(o){console.log("Error in object Creation ",o)}})()}createNewWDT(i){var t=this;return(0,R.Z)(function*(){try{t.allRDTDetails={},t.allRDTDetails={PK:i[0].trim(),SK:t.SK_clientID,wdt_parameter_id:i[0].trim(),wdt_parameter_label:i[1].trim(),parameters:JSON.stringify([]),updated:new Date};const o=Math.ceil((new Date).getTime()/1e3),u={P1:t.allRDTDetails.PK,P2:t.allRDTDetails.wdt_parameter_label,P3:"...(0)",P4:o};console.log("RDT details are here ",t.allRDTDetails),console.log("Lookup items are here ",u),(yield t.api.CreateWritingDeviceType(t.allRDTDetails))&&(yield t.createLookUpRdt(u,1))}catch(r){console.log("Error in object Creation ",r)}})()}updateWDT(i){var t=this;return(0,R.Z)(function*(){try{t.allRDTDetails={},t.allRDTDetails={PK:i[0].trim(),SK:t.SK_clientID,wdt_parameter_id:i[0].trim(),wdt_parameter_label:i[1].trim(),parameters:JSON.stringify([]),updated:new Date};let o="...(0)";try{o=t.lookup_data_user.find(n=>n.P1==t.allRDTDetails.PK).P3}catch(n){console.log("Error in filtering the lookup of rdt get the specific record",n)}const u=Math.ceil((new Date).getTime()/1e3),h={P1:t.allRDTDetails.PK,P2:t.allRDTDetails.wdt_parameter_label,P3:"...(0)",P4:u};(yield t.api.UpdateWritingDeviceType(t.allRDTDetails))&&(yield t.fetchTimeMachineById(1,h.P1,"update",h))}catch(r){console.log("Error in object Creation ",r)}})()}openFileUploadModal(i){this.modalService.open(i,{backdrop:"static",keyboard:!1,size:"lg",centered:!0})}onFileChange(i,t){this.savedFileEvent=i.target.files[0];const r=i.target;if(1!==r.files.length)throw new Error("Cannot use multiple files");const o=new FileReader;if(!i.target.value.includes(".xlsx"))return this.toast.open(" Error :Invalid file format","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});o.onload=u=>{const p=L.ij(u.target.result,{type:"binary"}),e=p.Sheets[p.SheetNames[0]];this.previewData=L.P6.sheet_to_json(e,{header:1}),this.WDT_Id=L.P6.sheet_to_json(e,{raw:!0}),this.grid||(this.grid=O({parentNode:this.container.nativeElement,data:[]}),this.grid.style.heigth="1440px",this.grid.style.width="100%"),this.grid.data=this.previewData,this.previewData=this.grid.data,this.currentPage=0,this.updatePagedData(),this.grid.addEventListener("afteredit",d=>{this.previewData[this.currentPage*this.pageSize+d.rowIndex][d.cellIndex]=d.value,console.log("this.previewData ",this.previewData)});try{if(this.grid&&this.grid.data&&this.grid.data[0]){const d=this.grid.data[0];console.log("Heading are here ",d);const c=["WDT Id","WDT Label","Reserved 1","Reserved 2","Reserved 3","Reserved 4","Reserved 5"],v=["WDT Id","Parameter ID","Parameter Label","Parameter Description","Start Address","Variable Type","Min Value","Max Value","mX+C X Multiplication Factor","mX+C C Addition Factor","Control Type","Step","Block Number","RDT ID","No of Binding Reading Parameter","Add Binding Reading Parameter","Enable Binding Reading Parameter","Reserved 1","Reserved 2","Reserved 3","Reserved 4","Reserved 5","No of Dropdown","Label","Value"];if("wdt_xlsx"==t){if(JSON.stringify(d)!=JSON.stringify(c))return A().fire({title:"WDT Template Mismatch",text:"Please check the file for the correct WDT template format.",icon:"error",confirmButtonText:"Ok"})}else if("wdt_xlsx"!=t&&JSON.stringify(d)!=JSON.stringify(v))return A().fire({title:"Writing Parameter Template Mismatch",text:"Please check the file for the correct WDT Parameter template format.",icon:"error",confirmButtonText:"Ok"})}}catch(d){console.log("Error checking the heading ",d)}},o.readAsBinaryString(r.files[0])}fetchLoggedInClientWDT(i){if(0===this.previewData[0].length)return this.toast.open(" Error :No file is selected","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if("wdt_xlsx"==i)for(let t=1;t<this.grid.data.length;t++)if(this.grid.data[t]&&this.grid.data[t][0]&&this.grid.data[t][0].trim().length>=2){for(let r=0;r<this.uniqueWDTList.length&&this.grid.data[t][0].trim()!==this.uniqueWDTList[r];r++)if(r==this.uniqueWDTList.length-1)return void this.toast.open("Column:A  Row: "+t+" WDT ID not exists","Add Already added WDT ID",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});this.multiWDT.push(this.grid.data[t][0].trim())}else if(null==this.grid.data[t][0]||null==this.grid.data[t][0]||""==this.grid.data[t][0])return this.toast.open("Column:A  Row: "+t+" WDT ID should not be empty","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if("parameter_xlsx"==i)for(let t=1;t<this.grid.data.length;t++){if(""==this.grid.data[t][0]||null==this.grid.data[t][0])return this.toast.open("WDT ID should not be empty","Add WDT ID",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});this.multiWDT.push(this.grid.data[t][0].trim())}this.api.ListWritingDeviceTypes({PK:{in:this.multiWDT},SK:{contains:this.userClientIDCognito.attributes["custom:clientID"]}},500).then(t=>{if(0==t.items?.length)return this.toast.open("No WDT found","Check other WDT",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(t&&t.items&&t.items.length>0){if(console.log("WDT value.items",t.items),"wdt_xlsx"==i){this.specific_WDT=t.items,delete this.specific_WDT[0].__typename;for(let r=0;r<t.items.length;r++)this.grid.data[r+1][0]=t.items[r]?.wdt_parameter_id,this.grid.data[r+1][1]=t.items[r]?.wdt_parameter_label;if(this.grid.data=this.grid.data,this.previewData=this.grid.data,this.currentPage=0,this.updatePagedData(),this.grid.addEventListener("afteredit",r=>{this.previewData[this.currentPage*this.pageSize+r.rowIndex][r.cellIndex]=r.value,console.log("this.previewData ",this.previewData)}),this.grid.data.length>=1)return this.toast.open("WDT Fetched Successfully","Ok",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"})}if("parameter_xlsx"==i){this.specific_WDT=t.items,console.log("WDT params items",t.items);let r=[],o=[],u=[];for(let h=0;h<this.specific_WDT.length;h++)if(u=JSON.parse(this.specific_WDT[h].parameters),0==u.length)this.toast.open("No Writing Parameters found for this device "+this.specific_WDT[h].PK,"Check other device",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});else{for(let n=0;n<u.length;n++)console.log("parameterData",u),r.push({PK:this.specific_WDT[h].PK,parameterID:u[n].parameterID,parameterLabel:u[n].parameterLabel,parameterDescription:u[n].parameterDescription,start_address:u[n].start_address,variable_type:u[n].variable_type,min:u[n].min,max:u[n].max,mX_C_X_Multiplication_Factor:u[n].mX_C_X_Multiplication_Factor,mX_C_C_Addition_Factor:u[n].mX_C_C_Addition_Factor,control_type:u[n].control_type,blockNumber:u[n].blockNumber,dropdownLabel_value:u[n]&&u[n].dropdownLabel_value&&"string"==typeof u[n].dropdownLabel_value?JSON.parse(u[n]?.dropdownLabel_value):u[n]?.dropdownLabel_value,step:u[n].step,rdt:u[n].rdt,count_binding_parameter:u[n].binding_parameter&&Array.isArray(u[n].binding_parameter)?u[n].binding_parameter.length:0,binding_parameter:u[n].binding_parameter&&u[n].binding_parameter.toString(),enable_binding_parameter:u[n].enable_binding_parameter});if(console.log("tempObject",r),0==h){o.push([]);for(let n=0;n<this.grid.data[0].length;n++)o[0].push(this.grid.data[0][n])}for(let n=0;n<r.length;n++){o.push([]);for(let d=0;d<this.grid.data[0].length;d++)o[o.length-1].push("");let e=o.length-1;o[e][0]=r[n].PK,o[e][1]=r[n].parameterID,o[e][2]=r[n].parameterLabel,o[e][3]=r[n].parameterDescription,o[e][4]=r[n].start_address,o[e][5]=r[n].variable_type,o[e][6]=r[n].min,o[e][7]=r[n].max,o[e][8]=r[n].mX_C_X_Multiplication_Factor,o[e][9]=r[n].mX_C_C_Addition_Factor,o[e][10]=r[n].control_type,o[e][11]=r[n].step,o[e][12]=r[n].blockNumber,o[e][13]=r[n].rdt,o[e][14]=r[n].count_binding_parameter,o[e][15]=r[n].binding_parameter,o[e][16]=r[n].enable_binding_parameter,o[e][22]=r[n].dropdownLabel_value&&Array.isArray(r[n].dropdownLabel_value)?r[n].dropdownLabel_value.length:0,o[e][23]=r[n].dropdownLabel_value&&Array.isArray(r[n].dropdownLabel_value)&&r[n].dropdownLabel_value.map(d=>d.dropdown_label).toString(),o[e][24]=r[n].dropdownLabel_value&&Array.isArray(r[n].dropdownLabel_value)&&r[n].dropdownLabel_value.map(d=>d.dropdown_value).toString()}r=[]}if(this.grid.data=o,this.previewData=this.grid.data,this.currentPage=0,this.updatePagedData(),this.grid.addEventListener("afteredit",h=>{this.previewData[this.currentPage*this.pageSize+h.rowIndex][h.cellIndex]=h.value,console.log("this.previewData ",this.previewData)}),console.log("this.grid.data",this.grid.data),this.grid.data.length>=1)return this.toast.open("WDT Parameter Fetched Successfully","Ok",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"})}}}).catch(t=>{console.log("No WDT found",t)})}createMutiWDTConfig(i){if(0===this.previewData[0].length)return this.toast.open(" Error :No file is selected","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if("wdt_xlsx"==i){if(this.tempMultiData=[],console.log("Iam triggered please check me"),0===this.previewData[0].length)return this.toast.open(" Error :No file is selected","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(!this.grid.data||this.grid.data.length<2||""==this.grid.data[1][0]||void 0===this.grid.data[1][0])return this.toast.open("Column:A  Row: 1 WDT ID is needed","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});for(let t=1;t<=this.grid.data.length-1;t++){if(this.ADD_finalData={},null==this.grid.data[t][0]||""===this.grid.data[t][0])return this.toast.open("Column:A  Row: "+t+" WDT ID is needed","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(32===this.grid.data[t][0].charCodeAt())return this.toast.open("Column:A  Row: "+t+" WDT ID not starts with space","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(this.grid.data[t][0]&&this.uniqueWDTList.includes(this.grid.data[t][0]))return this.toast.open("Column:A  Row: "+t+" WDT ID already exist","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(this.grid.data[t][0]&&this.grid.data[t][0].trim().length>=2){for(let r=0;r<this.uniqueWDTList.length;r++)if(this.uniqueWDTList[r]===this.grid.data[t][0].trim())return this.toast.open("Column:A  Row: "+t+" WDT ID already exists","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[t][1]||null==this.grid.data[t][1]||""==this.grid.data[t][1])return this.toast.open("Column:B  Row: "+t+" WDT label is needed","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(32===this.grid.data[t][1].charCodeAt(0))return this.toast.open("Column:B  Row: "+t+" WDT label should not start with space","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});this.ADD_finalData.PK=this.grid.data[t][0].trim(),this.ADD_finalData.SK=this.userClientIDCognito.attributes["custom:clientID"],this.renameKeys.push(Object.keys(this.ADD_finalData)),this.renameKeys[0]="wdt_parameter_id",this.renameKeys[1]="wdt_parameter_label";for(let r=0;r<this.grid.data[0].length;r++)null==this.grid.data[t][r]?this.grid.data[t][r]=null:this.ADD_finalData[this.renameKeys[r]]=this.grid.data[t][r];delete this.ADD_finalData.undefined,delete this.ADD_finalData["PK,SK"],this.ADD_finalData.wdt_parameter_id=this.ADD_finalData.wdt_parameter_id.trim(),this.ADD_finalData.wdt_parameter_label=this.ADD_finalData.wdt_parameter_label.trim(),this.ADD_finalData.updated=new Date,console.log("adding final data",this.ADD_finalData),this.tempMultiData.push(this.ADD_finalData)}}this.sendMultipleWDTDB(0)}if("parameter_xlsx"==i){let t=[],r=[],o="true",u="false",h=[];if(0===this.previewData[0].length)return this.toast.open(" Error :No file is selected","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});for(let e=1;e<=this.grid.data.length-1;e++){if(!this.grid.data||this.grid.data.length<2||""==this.grid.data[e][0]||void 0===this.grid.data[e][0])return this.toast.open("Column:A  Row: "+e+" WDT ID is needed","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(this.grid.data[e][0]&&0==this.uniqueWDTList.includes(this.grid.data[e][0]))return this.toast.open("Column:A  Row: "+e+" WDT ID does not exist","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"})}for(let e=1;e<this.grid.data.length;e++)null!=this.grid.data[e][1]&&r.push(this.grid.data[e][1]);let n=(e=r).filter((d,c)=>e.indexOf(d)!=c);if(0!=n.length)return this.toast.open("Column:B  Row:  "+n+" Duplicate Parameter ID not allowed","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});for(let e=1;e<this.grid.data.length;e++)if(this.ADD_finalData={},h=[],this.grid.data[e][0]&&this.grid.data[e][0].trim().length>=2){if(!(null!==this.grid.data[e][0]&&this.grid.data[e][0].length>=2))return this.toast.open("Column:B  Row: "+e+" WDT ID should be atleast 2 character","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[e][0]||""===this.grid.data[e][0])return this.toast.open("Column:A  Row: "+e+" WDT ID is needed","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(32===this.grid.data[e][0].charCodeAt(0))return this.toast.open("Column:A  Row: "+e+" WDT ID shouldn't starts with space","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});for(let l=0;l<this.uniqueWDTList.length&&this.uniqueWDTList[l]!==this.grid.data[e][0].trim();l++)if(l==this.uniqueWDTList.length-1)return void this.toast.open("Column:A  WDT ID not exists","Add Correct RDT ID",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[e][1]||""===this.grid.data[e][1])return this.toast.open("Column:B  Row: "+e+" Parameter ID should not be empty","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(32===this.grid.data[e][1].charCodeAt(0))return this.toast.open("Column:B  Row: "+e+" Parameter ID should not starts with space","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[e][2]||""===this.grid.data[e][2])return this.toast.open("Column:C  Row: "+e+" Parameter Label should not be empty","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(32===this.grid.data[e][2].charCodeAt(0))return this.toast.open("Column:C  Row: "+e+" Parameter Label should not starts with space","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[e][3]||""===this.grid.data[e][3])return this.toast.open("Column:D  Row: "+e+" Parameter Description should not be empty","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(32===this.grid.data[e][3].charCodeAt(0))return this.toast.open("Column:D  Row: "+e+" Parameter Descrition should not starts with space","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[e][4]||""===this.grid.data[e][4])return this.toast.open("Column:E  Row: "+e+" Start Address should not be empty","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(32===JSON.stringify(this.grid.data[e][4]).charCodeAt(0))return this.toast.open("Column:E  Row: "+e+" Start Address should not starts with space","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(!0===isNaN(this.grid.data[e][4]))return this.toast.open("Column:E  Row: "+e+" Start Address should be number","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[e][5]||""===this.grid.data[e][5])return this.toast.open("Column:F  Row: "+e+" Variable Type should not be empty","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(32===this.grid.data[e][5].charCodeAt(0))return this.toast.open("Column:F  Row: "+e+" Variable Type should not starts with space","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(!1!==isNaN(this.grid.data[e][6]))return this.toast.open("Column:G  Row: "+e+" Min must be number","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[e][6]||""===this.grid.data[e][6])return this.toast.open("Column:G  Row: "+e+" Min should not be empty","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(JSON.parse(this.grid.data[e][6])<0)return this.toast.open("Column:G  Row: "+e+" Min should not be negative","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(!1!==isNaN(this.grid.data[e][7]))return this.toast.open("Column:H  Row: "+e+" Max must be number","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[e][7]||""===this.grid.data[e][7])return this.toast.open("Column:H  Row: "+e+" Max should not be empty","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(JSON.parse(this.grid.data[e][7])<0)return this.toast.open("Column:H  Row: "+e+" Max should not be negative","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(!1!==isNaN(this.grid.data[e][8]))return this.toast.open("Column:I  Row: "+e+" Multiplication factor must be number","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[e][8]||""===this.grid.data[e][8])return this.toast.open("Column:I  Row: "+e+" Multiplication factor should not be empty","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(JSON.parse(this.grid.data[e][8])<0)return this.toast.open("Column:I  Row: "+e+" Multiplication factor should not be negative","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(!1!==isNaN(this.grid.data[e][9]))return this.toast.open("Column:J  Row: "+e+" Addition factor must be number","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[e][9]||""===this.grid.data[e][9])return this.toast.open("Column:J  Row: "+e+" Addition factor should not be empty","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(JSON.parse(this.grid.data[e][9])<0)return this.toast.open("Column:J  Row: "+e+" Addition factor should not be negative","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(this.enable_binding_parameter=this.grid.data[e][15],null!=this.enable_binding_parameter&&""!==this.enable_binding_parameter){let l="";if("boolean"==typeof this.enable_binding_parameter?l=JSON.stringify(this.enable_binding_parameter).trim().toLowerCase():0==isNaN(this.enable_binding_parameter)||(l=this.enable_binding_parameter.trim().toLowerCase()),l!==o&&l!==u)return this.toast.open("Column:P  Row: "+e+" Enable Binding Parameter must be boolean","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(l!==u&&l!==o)return this.toast.open("Column:P  Row: "+e+" Enable Binding Parameter must be boolean","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});(l==o||l==u)&&(this.enable_binding_parameter=l)}else this.enable_binding_parameter=!1;if(null==this.grid.data[e][10]||""===this.grid.data[e][10])return this.toast.open("Column:K  Row: "+e+" Control Type should not be empty","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[e][11]||""===this.grid.data[e][11])return this.toast.open("Column:L  Row: "+e+" Step should not be empty","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});this.ADD_finalData.PK=this.grid.data[e][0].trim(),this.ADD_finalData.SK=this.userClientIDCognito.attributes["custom:clientID"],this.ADD_finalData.parameters=[],this.renameKeys[1]="parameterID",this.renameKeys[2]="parameterLabel",this.renameKeys[3]="parameterDescription",this.renameKeys[4]="start_address",this.renameKeys[5]="variable_type",this.renameKeys[6]="min",this.renameKeys[7]="max",this.renameKeys[8]="mX_C_X_Multiplication_Factor",this.renameKeys[9]="mX_C_C_Addition_Factor",this.renameKeys[10]="control_type",this.renameKeys[11]="step",this.renameKeys[12]="rdt",this.renameKeys[13]="count_binding_parameter",this.renameKeys[14]="binding_parameter",this.renameKeys[15]="enable_binding_parameter",this.renameKeys[21]="dropdownLabel_value";let c=21;for(let l=1;l<=this.grid.data[e][21];l++,c++)if(h.push({dropdown_label:this.grid.data[e][c+l],dropdown_value:this.grid.data[e][c+l+1]}),!0===isNaN(this.grid.data[e][c+l+1])){if(c+l+1==23)return this.toast.open("Column:X  Row: "+e+" Value should be number","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(c+l+1==25)return this.toast.open("Column:Z  Row: "+e+" Value should be number","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"})}console.log("dropdown_label_value",h);for(let l=0;l<this.grid.data[0].length;l++)null==this.grid.data[e][l]?this.grid.data[e][l]=null:(21==l&&(this.grid.data[e][l]=JSON.stringify(h.length)),this.ADD_finalData[this.renameKeys[l]]=this.grid.data[e][l]);delete this.ADD_finalData.undefined,this.ADD_finalData.updated=new Date,this.ADD_finalData.enable_binding_parameter=this.enable_binding_parameter,this.ADD_finalData.dropdownLabel_value=JSON.stringify(h),console.log("this.ADD_finalData",this.ADD_finalData),t.push(this.ADD_finalData);let v=[];for(let l=0;l<t.length;l++)v.push({PK:t[l].PK,SK:t[l].SK,updated:t[l].updated});const y=v.map(l=>l.PK),f=v.filter(({PK:l},s)=>!y.includes(l,s+1));let I=[];for(let l=0;l<f.length;l++)I.push({PK:f[l].PK,SK:f[l].SK,parameters:[],updated:f[l].updated});for(let l=0;l<t.length;l++)for(let s=0;s<I.length;s++)"PK"in I[s]&&I[s].PK==t[l].PK?I[s].parameters.push({parameterID:t[l].parameterID,parameterLabel:t[l].parameterLabel,parameterDescription:t[l].parameterDescription,start_address:t[l].start_address,variable_type:t[l].variable_type,min:t[l].min,max:t[l].max,mX_C_X_Multiplication_Factor:t[l].mX_C_X_Multiplication_Factor,mX_C_C_Addition_Factor:t[l].mX_C_C_Addition_Factor,control_type:t[l].control_type,dropdownLabel_value:t[l].dropdownLabel_value,step:t[l].step.toString(),rdt:t[l].rdt,count_binding_parameter:t[l].count_binding_parameter,binding_parameter:"string"==typeof t[l].binding_parameter?t[l].binding_parameter.split(","):t[l].binding_parameter,enable_binding_parameter:!(0==t[l].enable_binding_parameter||"false"==t[l].enable_binding_parameter)}):"PK"in I[s]||(I[s].PK=t[l].PK,I[s].parameters=[],I[s].parameters.push({parameterID:t[l].parameterID,parameterLabel:t[l].parameterLabel,parameterDescription:t[l].parameterDescription,start_address:t[l].start_address,variable_type:t[l].variable_type,min:t[l].min,max:t[l].max,mX_C_X_Multiplication_Factor:t[l].mX_C_X_Multiplication_Factor,mX_C_C_Addition_Factor:t[l].mX_C_C_Addition_Factor,control_type:t[l].control_type,dropdownLabel_value:t[l].dropdownLabel_value,step:t[l].step.toString(),rdt:t[l].rdt,count_binding_parameter:t[l].count_binding_parameter,binding_parameter:"string"==typeof t[l].binding_parameter?t[l].binding_parameter.split(","):t[l].binding_parameter,enable_binding_parameter:!(0==t[l].enable_binding_parameter||"false"==t[l].enable_binding_parameter)}));this.tempMultiParams=I;for(let l=0;l<this.tempMultiParams.length;l++)this.tempMultiParams[l].parameters=JSON.stringify(this.tempMultiParams[l].parameters)}this.sendMultipleWDTParamsDB(0)}var e}sendMultipleWDTParamsDB(i){var t=this;return(0,R.Z)(function*(){if(i<t.tempMultiParams.length){console.log("this.multi alerts index",t.tempMultiParams[i]);let r=JSON.parse(t.tempMultiParams[i].parameters),o="";o=r?1===r.length?r[0].parameterID:r.length>1?r[0].parameterID+"...("+r.length+")":"...(0)":"...(0)";const h=yield t.api.GetWritingDeviceType(t.tempMultiParams[i].PK,t.SK_clientID);console.log("Result is here ",h);const p=Math.ceil((new Date).getTime()/1e3),n={P1:t.tempMultiParams[i].PK,P2:h.wdt_parameter_label,P3:o,P4:p};console.log("Items to be added are here ",n),t.api.UpdateWritingDeviceType(t.tempMultiParams[i]).then(function(){var e=(0,R.Z)(function*(d){console.log("added index",i),d?(yield t.fetchTimeMachineById(1,n.P1,"update",n),t.sendMultipleWDTParamsDB(i+1)):alert("Error in Creating Parameter Configuration")});return function(d){return e.apply(this,arguments)}}()).catch(e=>{console.log("err for creation",i),t.toast.open("Error in Creating Parameter Configuration ","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"})})}else t.toast.open(t.tempMultiParams.length+" WDT's Parameters added successfully "," ",{duration:2e3,horizontalPosition:"right",verticalPosition:"top"})})()}sendMultipleWDTDB(i){var t=this;if(i<this.tempMultiData.length){const r=Math.ceil((new Date).getTime()/1e3),o={P1:this.tempMultiData[i].PK,P2:this.tempMultiData[i].wdt_parameter_label,P3:"...(0)",P4:r};console.log("Writing parameter is for lookup",o),this.api.CreateWritingDeviceType(this.tempMultiData[i]).then(function(){var u=(0,R.Z)(function*(h){h?(yield t.createLookUpRdt(o,1),t.sendMultipleWDTDB(i+1)):alert("Error in Creating New WDT")});return function(h){return u.apply(this,arguments)}}()).catch(u=>{console.log("err for creation",u),this.toast.open("Error in Creating New WDT ","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"})})}else this.fetchTMLookupData(1),this.toast.open(i+" WDT added successfully"," ",{duration:2e3,horizontalPosition:"right",verticalPosition:"top"})}createLookUpRdt(i,t){var r=this;return(0,R.Z)(function*(){try{console.log("iam a calleddd dude",i,t);const o=yield r.api.GetLookupMasterTable(r.clientID,t);let u=[];if(null!=o&&o.items&&"string"==typeof o.items&&(u=JSON.parse(o.items)),null!=o&&u.length<r.maxlength){let h=[];o.items&&"string"==typeof o.items&&JSON.parse(o.items).forEach(d=>{for(const c in d)Object.prototype.hasOwnProperty.call(d,c)&&h.push(d[c])}),h.unshift(i),h=h.map((e,d)=>({[`L${d+1}`]:e})),console.log("newdata 11111111 :>> ",h);let p={PK:r.clientID,SK:o.SK,createdTime:"",updatedTime:"",items:JSON.stringify(h)};const n=yield r.api.UpdateLookupMasterTable(p);console.log("createResponse :>> ",n)}else if(null==o){let h=[];h.push(i),h=h.map((e,d)=>({[`L${d+1}`]:e}));let p={SK:t,PK:r.clientID,items:JSON.stringify(h)};console.log(p);const n=yield r.api.CreateLookupMasterTable(p);console.log(n)}else yield r.createLookUpRdt(i,t+1)}catch(o){console.log("err :>> ",o)}})()}updateMultiWDTxlsx(i){if(0===this.previewData[0].length)return this.toast.open(" Error :No file is selected","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if("wdt_xlsx"==i){if(this.tempMultiData=[],0===this.previewData[0].length)return this.toast.open(" Error :No file is selected","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});for(let t=1;t<=this.grid.data.length-1;t++)if(!this.grid.data||this.grid.data.length<2||""==this.grid.data[t][0]||void 0===this.grid.data[t][0])return this.toast.open("Column:A  Row: 1 WDT ID is needed","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});for(let t=1;t<=this.grid.data.length-1;t++)if(this.ADD_finalData={},this.grid.data[t]&&this.grid.data[t][0]&&this.grid.data[t][0].trim().length>=2){for(let o=0;o<this.uniqueWDTList.length&&this.grid.data[t][0].trim()!==this.uniqueWDTList[o];o++)if(o==this.uniqueWDTList.length-1)return void this.toast.open("Column:A  Row: "+t+" WDT ID not exists","Add existing WDT ID",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[t][0]||null==this.grid.data[t][0]||""==this.grid.data[t][0])return this.toast.open("Column:A  Row: "+t+" WDT ID is needed","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(32===this.grid.data[t][0].charCodeAt(0))return this.toast.open("WDT ID should not start with space","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[t][1]||null==this.grid.data[t][1]||""==this.grid.data[t][1])return this.toast.open("Column:B  Row: "+t+" WDT label is needed","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(32===this.grid.data[t][1].charCodeAt(0))return this.toast.open("Column:B  Row: "+t+" WDT label should not start with space","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});this.ADD_finalData.PK=this.grid.data[t][0].trim(),this.ADD_finalData.SK=this.userClientIDCognito.attributes["custom:clientID"],this.renameKeys.push(Object.keys(this.ADD_finalData)),this.renameKeys[0]="wdt_parameter_id",this.renameKeys[1]="wdt_parameter_label";for(let o=0;o<this.grid.data[0].length;o++)null==this.grid.data[t][o]?this.grid.data[t][o]=null:this.ADD_finalData[this.renameKeys[o]]=this.grid.data[t][o];delete this.ADD_finalData.undefined,delete this.ADD_finalData["PK,SK"],this.ADD_finalData.updated=new Date,this.tempMultiData.push(this.ADD_finalData)}this.updateMultiWDTDB(0)}if("parameter_xlsx"==i){let t=[],r=[],o="true",u="false",h=[];if(0===this.previewData[0].length)return this.toast.open(" Error :No file is selected","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});for(let e=1;e<=this.grid.data.length-1;e++)if(!this.grid.data||this.grid.data.length<2||""==this.grid.data[e][0]||void 0===this.grid.data[e][0])return this.toast.open("Column:A  Row: "+e+" WDT ID is needed","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});for(let e=1;e<this.grid.data.length;e++)null!=this.grid.data[e][1]&&r.push(this.grid.data[e][1]);let n=(e=r).filter((d,c)=>e.indexOf(d)!=c);if(0!=n.length)return this.toast.open("Column:B  Row:  "+n+" Duplicate Parameter ID not allowed","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});for(let e=1;e<this.grid.data.length;e++)if(this.ADD_finalData={},h=[],this.grid.data[e][0]&&this.grid.data[e][0].trim().length>=2){if(!(null!==this.grid.data[e][0]&&this.grid.data[e][0].length>=2))return this.toast.open("Column:B  Row: "+e+" WDT ID should be atleast 2 character","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[e][0]||""===this.grid.data[e][0])return this.toast.open("Column:A  Row: "+e+" WDT ID is needed","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(32===this.grid.data[e][0].charCodeAt(0))return this.toast.open("Column:A  Row: "+e+" WDT ID shouldn't starts with space","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});for(let s=0;s<this.uniqueWDTList.length&&this.uniqueWDTList[s]!==this.grid.data[e][0].trim();s++)if(s==this.uniqueWDTList.length-1)return void this.toast.open("Column:A  WDT ID not exists","Add Correct WDT ID",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[e][1]||""===this.grid.data[e][1])return this.toast.open("Column:B  Row: "+e+" Parameter ID should not be empty","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(32===this.grid.data[e][1].charCodeAt(0))return this.toast.open("Column:B  Row: "+e+" Parameter ID should not starts with space","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[e][2]||""===this.grid.data[e][2])return this.toast.open("Column:C  Row: "+e+" Parameter Label should not be empty","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(32===this.grid.data[e][2].charCodeAt(0))return this.toast.open("Column:C  Row: "+e+" Parameter Label should not starts with space","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[e][3]||""===this.grid.data[e][3])return this.toast.open("Column:D  Row: "+e+" Parameter Description should not be empty","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(32===this.grid.data[e][3].charCodeAt(0))return this.toast.open("Column:D  Row: "+e+" Parameter Descrition should not starts with space","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[e][4]||""===this.grid.data[e][4])return this.toast.open("Column:E  Row: "+e+" Start Address should not be empty","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(32===JSON.stringify(this.grid.data[e][4]).charCodeAt(0))return this.toast.open("Column:E  Row: "+e+" Start Address should not starts with space","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(!0===isNaN(this.grid.data[e][4]))return this.toast.open("Column:E  Row: "+e+" Start Address should be number","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[e][5]||""===this.grid.data[e][5])return this.toast.open("Column:F  Row: "+e+" Variable Type should not be empty","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(32===this.grid.data[e][5].charCodeAt(0))return this.toast.open("Column:F  Row: "+e+" Variable Type should not starts with space","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(!1!==isNaN(this.grid.data[e][6]))return this.toast.open("Column:G  Row: "+e+" Min must be number","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[e][6]||""===this.grid.data[e][6])return this.toast.open("Column:G  Row: "+e+" Min should not be empty","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(JSON.parse(this.grid.data[e][6])<0)return this.toast.open("Column:G  Row: "+e+" Min should not be negative","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(!1!==isNaN(this.grid.data[e][7]))return this.toast.open("Column:H  Row: "+e+" Max must be number","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[e][7]||""===this.grid.data[e][7])return this.toast.open("Column:H  Row: "+e+" Max should not be empty","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(JSON.parse(this.grid.data[e][7])<0)return this.toast.open("Column:H  Row: "+e+" Max should not be negative","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(!1!==isNaN(this.grid.data[e][8]))return this.toast.open("Column:I  Row: "+e+" Multiplication factor must be number","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[e][8]||""===this.grid.data[e][8])return this.toast.open("Column:I  Row: "+e+" Multiplication factor should not be empty","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(JSON.parse(this.grid.data[e][8])<0)return this.toast.open("Column:I  Row: "+e+" Multiplication factor should not be negative","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(!1!==isNaN(this.grid.data[e][9]))return this.toast.open("Column:J  Row: "+e+" Addition factor must be number","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[e][9]||""===this.grid.data[e][9])return this.toast.open("Column:J  Row: "+e+" Addition factor should not be empty","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(JSON.parse(this.grid.data[e][9])<0)return this.toast.open("Column:J  Row: "+e+" Addition factor should not be negative","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(this.enable_binding_parameter=this.grid.data[e][15],null!=this.enable_binding_parameter&&""!==this.enable_binding_parameter){let s="";if("boolean"==typeof this.enable_binding_parameter?s=JSON.stringify(this.enable_binding_parameter).trim().toLowerCase():0==isNaN(this.enable_binding_parameter)||(s=this.enable_binding_parameter.trim().toLowerCase()),s!==o&&s!==u)return this.toast.open("Column:P  Row: "+e+" Enable Binding Parameter must be boolean","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(s!==u&&s!==o)return this.toast.open("Column:P  Row: "+e+" Enable Binding Parameter must be boolean","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});(s==o||s==u)&&(this.enable_binding_parameter=s)}else this.enable_binding_parameter=u;if(null==this.grid.data[e][10]||""===this.grid.data[e][10])return this.toast.open("Column:K  Row: "+e+" Control Type should not be empty","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(null==this.grid.data[e][11]||""===this.grid.data[e][11])return this.toast.open("Column:L  Row: "+e+" Step should not be empty","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});this.ADD_finalData.PK=this.grid.data[e][0].trim(),this.ADD_finalData.SK=this.userClientIDCognito.attributes["custom:clientID"],this.ADD_finalData.parameters=[],this.renameKeys[1]="parameterID",this.renameKeys[2]="parameterLabel",this.renameKeys[3]="parameterDescription",this.renameKeys[4]="start_address",this.renameKeys[5]="variable_type",this.renameKeys[6]="min",this.renameKeys[7]="max",this.renameKeys[8]="mX_C_X_Multiplication_Factor",this.renameKeys[9]="mX_C_C_Addition_Factor",this.renameKeys[10]="control_type",this.renameKeys[11]="step",this.renameKeys[12]="rdt",this.renameKeys[13]="count_binding_parameter",this.renameKeys[14]="binding_parameter",this.renameKeys[15]="enable_binding_parameter",this.renameKeys[21]="dropdownLabel_value";let c=21,v="";for(let s=1;s<=this.grid.data[e][21];s++,c++)if(h.push({dropdown_label:"string"==typeof this.grid.data[e][c+s]?this.grid.data[e][c+s].trim():this.grid.data[e][c+s],dropdown_value:"string"==typeof this.grid.data[e][c+s+1]?this.grid.data[e][c+s+1].trim():this.grid.data[e][c+s+1]}),!0===isNaN(this.grid.data[e][c+s+1])){if(c+s+1==23)return this.toast.open("Column:X  Row: "+e+" Value should be number","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"});if(c+s+1==25)return this.toast.open("Column:Z  Row: "+e+" Value should be number","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"})}null!=this.grid.data[e][14]&&(v=this.grid.data[e][14]&&this.grid.data[e][14].includes(",")?this.grid.data[e][14].split(","):[]),console.log("splittedBindingParams",v),console.log("dropdown_label_value",h);for(let s=0;s<this.grid.data[0].length;s++)null==this.grid.data[e][s]?this.grid.data[e][s]=null:(21==s&&(this.grid.data[e][s]=JSON.stringify(h.length)),this.ADD_finalData[this.renameKeys[s]]=this.grid.data[e][s]);delete this.ADD_finalData.undefined,this.ADD_finalData.updated=new Date,this.ADD_finalData.enable_binding_parameter=this.enable_binding_parameter,this.ADD_finalData.dropdownLabel_value=JSON.stringify(h),t.push(this.ADD_finalData);let y=[];for(let s=0;s<t.length;s++)y.push({PK:t[s].PK,SK:t[s].SK,updated:t[s].updated});const f=y.map(s=>s.PK),I=y.filter(({PK:s},_)=>!f.includes(s,_+1));let l=[];for(let s=0;s<I.length;s++)l.push({PK:I[s].PK,SK:I[s].SK,parameters:[],updated:I[s].updated});for(let s=0;s<t.length;s++)for(let _=0;_<l.length;_++)"PK"in l[_]&&l[_].PK==t[s].PK?l[_].parameters.push({parameterID:t[s].parameterID,parameterLabel:t[s].parameterLabel,parameterDescription:t[s].parameterDescription,start_address:t[s].start_address,variable_type:t[s].variable_type,min:t[s].min,max:t[s].max,mX_C_X_Multiplication_Factor:t[s].mX_C_X_Multiplication_Factor,mX_C_C_Addition_Factor:t[s].mX_C_C_Addition_Factor,control_type:t[s].control_type,dropdownLabel_value:t[s].dropdownLabel_value,step:t[s].step.toString(),rdt:t[s].rdt,count_binding_parameter:t[s].count_binding_parameter,binding_parameter:"string"==typeof t[s].binding_parameter?t[s].binding_parameter.split(","):t[s].binding_parameter,enable_binding_parameter:!(0==t[s].enable_binding_parameter||"false"==t[s].enable_binding_parameter)}):"PK"in l[_]||(l[_].PK=t[s].PK,l[_].parameters=[],l[_].parameters.push({parameterID:t[s].parameterID,parameterLabel:t[s].parameterLabel,parameterDescription:t[s].parameterDescription,start_address:t[s].start_address,variable_type:t[s].variable_type,min:t[s].min,max:t[s].max,mX_C_X_Multiplication_Factor:t[s].mX_C_X_Multiplication_Factor,mX_C_C_Addition_Factor:t[s].mX_C_C_Addition_Factor,control_type:t[s].control_type,dropdownLabel_value:t[s].dropdownLabel_value,step:t[s].step.toString(),rdt:t[s].rdt,count_binding_parameter:t[s].count_binding_parameter,binding_parameter:"string"==typeof t[s].binding_parameter?t[s].binding_parameter.split(","):t[s].binding_parameter,enable_binding_parameter:!(0==t[s].enable_binding_parameter||"false"==t[s].enable_binding_parameter)}));this.tempMultiParams=l;for(let s=0;s<this.tempMultiParams.length;s++)this.tempMultiParams[s].parameters=JSON.stringify(this.tempMultiParams[s].parameters)}this.updateMultipleWDTParamsDB(0)}var e}updateMultipleWDTParamsDB(i){var t=this;return(0,R.Z)(function*(){if(i<t.tempMultiParams.length){console.log("this.multi alerts index",t.tempMultiParams[i]);let r=JSON.parse(t.tempMultiParams[i].parameters),o="";o=r?1===r.length?r[0].parameterID:r.length>1?r[0].parameterID+"...("+r.length+")":"...(0)":"...(0)";const h=yield t.api.GetWritingDeviceType(t.tempMultiParams[i].PK,t.SK_clientID);console.log("result is here ",h);const p=Math.ceil((new Date).getTime()/1e3),n={P1:t.tempMultiParams[i].PK,P2:h.wdt_parameter_label,P3:o,P4:p};console.log("Items are here ",n),t.api.UpdateWritingDeviceType(t.tempMultiParams[i]).then(function(){var e=(0,R.Z)(function*(d){console.log("added index",i),d?(yield t.fetchTimeMachineById(1,n.P1,"update",n),t.updateMultipleWDTParamsDB(i+1)):alert("Error in updating Parameter Configuration")});return function(d){return e.apply(this,arguments)}}()).catch(e=>{console.log("err for updation",e),t.toast.open("Error in Updating Parameter Configuration ","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"})})}else t.toast.open(t.tempMultiParams.length+" WDT's Parameters updated successfully "," ",{duration:2e3,horizontalPosition:"right",verticalPosition:"top"})})()}updateMultiWDTDB(i){var t=this;if(i<this.tempMultiData.length){console.log("All the writing parameters are here ",this.tempMultiData[i]);let r=this.tempMultiData[i].parameters,o="";o=r?1===r.length?r[0].parameterID:r.length>1?r[0].parameterID+"...("+r.length+")":"...(0)":"...(0)";const h=Math.ceil((new Date).getTime()/1e3),p={P1:this.tempMultiData[i].PK,P2:this.tempMultiData[i].wdt_parameter_label,P3:o,P4:h};console.log("This data will be updated ",p),this.api.UpdateWritingDeviceType(this.tempMultiData[i]).then(function(){var n=(0,R.Z)(function*(e){e?(yield t.fetchTimeMachineById(1,p.P1,"update",p),t.updateMultiWDTDB(i+1)):alert("Error in Updating WDT")});return function(e){return n.apply(this,arguments)}}()).catch(n=>{console.log("err for updation",n),this.toast.open("Error in Updating WDT ","Check again",{duration:5e3,horizontalPosition:"right",verticalPosition:"top"})})}else this.toast.open(i+" WDT updated successfully"," ",{duration:2e3,horizontalPosition:"right",verticalPosition:"top"})}fetchTimeMachineById(i,t,r,o){var u=this;return(0,R.Z)(function*(){try{const h=yield u.api.GetLookupMasterTable(u.clientID,i);if(h&&h.items){let p=yield JSON.parse(h.items),n=p.findIndex(e=>e[Object.keys(e)[0]].P1===t);if(-1!==n){if("update"===r){p[n][`L${n+1}`]=o;const d=[];for(let c=0;c<p.length;c++){const v=Object.keys(p[c])[0],y=`L${c+1}`;if(v){const f={[y]:p[c][v]},I=d.findIndex(l=>Object.keys(l)[0]===y);-1!==I?Object.assign(d[I][y],p[c][v]):d.push(f)}else console.error(`Original key not found for renaming in data[${c}].`)}p=d}else"delete"===r&&p.splice(n,1);let e={PK:u.clientID,SK:h.SK,items:JSON.stringify(p)};yield u.api.UpdateLookupMasterTable(e)}else yield new Promise(e=>setTimeout(e,500)),yield u.fetchTimeMachineById(i+1,t,r,o)}else A().fire({position:"top-right",icon:"error",title:`ID ${t} not found`,showConfirmButton:!1,timer:1500})}catch(h){console.error("Error:",h)}})()}updatePagedData(){const i=this.currentPage*this.pageSize;this.pagedPreviewData=this.previewData.slice(i,i+this.pageSize),this.totalPages=Math.ceil(this.previewData.length/this.pageSize),this.grid.data=this.pagedPreviewData,this.cd.detectChanges()}loadGridData(i){this.previewData=i,this.currentPage=0,this.updatePagedData()}nextPage(){this.currentPage<this.totalPages-1&&(this.currentPage++,this.updatePagedData())}prevPage(){this.currentPage>0&&(this.currentPage--,this.updatePagedData())}}return P=T,(0,g.Z)(T,"\u0275fac",function(i){return new(i||P)(a.Y36(S.QS),a.Y36(Z.ux),a.Y36(q.t),a.Y36(B.F),a.Y36(F.F0),a.Y36(z.t2),a.Y36(J),a.Y36(a.sBO),a.Y36(U),a.Y36($.FF))}),(0,g.Z)(T,"\u0275cmp",a.Xpm({type:P,selectors:[["app-writingdevicetype-xlsx"]],viewQuery:function(i,t){if(1&i&&(a.Gf(j,7),a.Gf(G,5)),2&i){let r;a.iGM(r=a.CRH())&&(t.fileUpload=r.first),a.iGM(r=a.CRH())&&(t.container=r.first)}},decls:35,vars:11,consts:[["bdColor","rgba(0, 0, 0, 0.8)","size","medium","color","#fff","type","ball-atom",3,"fullScreen"],[2,"color","white"],[1,"card","p-5","modern-card","shadow",3,"formGroup"],[1,"mb-4","text-primary","fw-bold"],[1,"row","g-4"],[1,"col-md-6"],[1,"form-label","fw-semibold","text-dark"],[1,"text-danger"],["formControlName","type","required","",1,"form-select","custom-select"],["value","","disabled","","selected",""],["value","wdt_xlsx"],["value","parameter_xlsx"],["class","text-danger",4,"ngIf"],["class","col-md-6",4,"ngIf"],[1,"col-12"],[1,"scroll-grid-container"],[1,"sticky-toolbar","d-flex","flex-wrap","gap-2","p-2","bg-white","border-bottom","shadow-sm"],[1,"btn","btn-warning","text-dark",3,"disabled","click"],["class","btn btn-primary",3,"disabled","click",4,"ngIf"],["class","btn btn-info text-white",3,"disabled","click",4,"ngIf"],["class","btn btn-success",3,"disabled","click",4,"ngIf"],["class","btn btn-dark",3,"disabled","click",4,"ngIf"],["id","grid",1,"excel-output","modern-grid","mt-4"],["container",""],["class","pagination-controls d-flex justify-content-between align-items-center mt-3",4,"ngIf"],["fileUpload",""],["type","file","accept",".xlsx",1,"form-control","modern-file",3,"change"],[1,"btn","btn-primary",3,"disabled","click"],[1,"btn","btn-info","text-white",3,"disabled","click"],[1,"btn","btn-success",3,"disabled","click"],[1,"btn","btn-dark",3,"disabled","click"],[1,"bi","bi-download","fs-5"],[1,"pagination-controls","d-flex","justify-content-between","align-items-center","mt-3"],[1,"btn","btn-outline-secondary","btn-sm",3,"disabled","click"],[1,"modal-header","bg-danger","text-white"],[1,"modal-title"],["type","button",1,"btn-close","btn-close-white",3,"click"],[1,"modal-body"],["class","alert alert-danger",4,"ngIf"],["class","validation-errors mt-3",4,"ngIf"],[1,"modal-footer"],[1,"btn","btn-secondary",3,"click"],[1,"alert","alert-danger"],[1,"validation-errors","mt-3"],[1,"d-flex","justify-content-between","align-items-center","mb-2"],[1,"badge","bg-danger"],[1,"validation-list","mt-2",2,"max-height","200px","overflow-y","auto"],[1,"table","table-sm","table-bordered","mb-0"],[1,"table-light"],[4,"ngFor","ngForOf"],[1,"text-center",2,"width","60px"]],template:function(i,t){if(1&i&&(a.TgZ(0,"ngx-spinner",0)(1,"p",1),a._uU(2,"Please wait Table is Loading... "),a.qZA()(),a.TgZ(3,"div",2)(4,"h4",3),a._uU(5,"Writing Device Type"),a.qZA(),a.TgZ(6,"div",4)(7,"div",5)(8,"label",6),a._uU(9," Type "),a.TgZ(10,"span",7),a._uU(11,"*"),a.qZA()(),a.TgZ(12,"select",8)(13,"option",9),a._uU(14,"Select Type"),a.qZA(),a.TgZ(15,"option",10),a._uU(16,"Writing Device Type"),a.qZA(),a.TgZ(17,"option",11),a._uU(18,"Parameter"),a.qZA()(),a.YNc(19,H,2,0,"small",12),a.qZA(),a.YNc(20,Y,4,0,"div",13),a.TgZ(21,"div",14)(22,"div",15)(23,"div",16)(24,"button",17),a.NdJ("click",function(){let o;return t.exportTemplate(null==(o=t.createWDTXlsx.get("type"))?null:o.value)}),a._uU(25," \u2b07 Export Template "),a.qZA(),a.YNc(26,Q,2,1,"button",18),a.YNc(27,tt,2,1,"button",19),a.YNc(28,et,2,1,"button",20),a.YNc(29,it,3,1,"button",21),a.qZA(),a._UZ(30,"div",22,23),a.YNc(32,at,7,4,"div",24),a.qZA()()(),a.YNc(33,st,10,2,"ng-template",null,25,a.W1O),a.qZA()),2&i){let r,o,u;a.Q6J("fullScreen",!0),a.xp6(3),a.Q6J("formGroup",t.createWDTXlsx),a.xp6(16),a.Q6J("ngIf",(null==(r=t.createWDTXlsx.get("type"))?null:r.hasError("required"))&&(null==(r=t.createWDTXlsx.get("type"))?null:r.touched)),a.xp6(1),a.Q6J("ngIf",a.DdM(10,lt).includes(null==(o=t.createWDTXlsx.get("type"))?null:o.value)),a.xp6(4),a.Q6J("disabled",!(null!=(u=t.createWDTXlsx.get("type"))&&u.value)),a.xp6(2),a.Q6J("ngIf",t.hideUpdateButton&&t.savedFileEvent),a.xp6(1),a.Q6J("ngIf",t.hideGetButton&&t.savedFileEvent),a.xp6(1),a.Q6J("ngIf",t.hideUpdateButton&&t.savedFileEvent),a.xp6(1),a.Q6J("ngIf",t.hideUpdateButton&&t.savedFileEvent),a.xp6(3),a.Q6J("ngIf",t.totalPages)}},dependencies:[N.sg,N.O5,S.YN,S.Kr,S.EJ,S.JJ,S.JL,S.Q7,S.sg,S.u],styles:[".spinner-text[_ngcontent-%COMP%]{color:#fff;font-size:1rem;text-align:center}.modern-card[_ngcontent-%COMP%]{background-color:#fff;border-radius:12px;border:none}.custom-select[_ngcontent-%COMP%]{border:1px solid #dee2e6;border-radius:6px;background-color:#f8f9fa;transition:all .3s ease}.custom-select[_ngcontent-%COMP%]:focus{border-color:#4c6ef5;box-shadow:0 0 0 .2rem #4c6ef540}.modern-file[_ngcontent-%COMP%]{border-radius:6px;border:1px solid #ced4da;background-color:#f8f9fa;transition:all .3s}.modern-file[_ngcontent-%COMP%]:focus{border-color:#4c6ef5;box-shadow:0 0 0 .2rem #4c6ef540}button[_ngcontent-%COMP%]{transition:.3s ease-in-out}button[_ngcontent-%COMP%]:hover{transform:scale(1.03)}.modern-grid[_ngcontent-%COMP%]{background-color:#f1f3f5;padding:1rem;border:1px solid #dee2e6;border-radius:8px}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;top:0;background-color:#fff}.table-danger[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#ffa8a8}.scroll-grid-container[_ngcontent-%COMP%]{position:relative;height:500px;overflow-y:auto;border:1px solid #dee2e6;border-radius:10px;background:#f9f9f9}.sticky-toolbar[_ngcontent-%COMP%]{position:sticky;top:0;z-index:10;background-color:#fff;border-radius:10px 10px 0 0}"]})),T})(),ut=(()=>{var P;class T{}return P=T,(0,g.Z)(T,"\u0275fac",function(i){return new(i||P)}),(0,g.Z)(T,"\u0275mod",a.oAB({type:P})),(0,g.Z)(T,"\u0275inj",a.cJS({imports:[N.ez,Z.ZX,z.ef,F.Bz.forChild([{path:"",component:dt}])]})),T})()}}]);